define(["jquery","layerWrapper","template","jquery.ajax.extension"],function(a,b,c){!function(a){var d=a("#pointContainer"),e={};a(".lottery-right-group").find("h3 span").on("click",function(){var b=a(this),c=b.index(),d=a(this).parent().siblings(".record-list").find(".record-item");b.addClass("active").siblings().removeClass("active"),d.eq(c).show().siblings(".record-item").hide()}),d.find(".tip-list-frame .tip-list").each(function(b,c){var d=a(c).attr("id");e[d]=c});var f={prizeType:"",prizeKind:0,click:!1,index:-1,count:0,timer:0,speed:20,times:0,cycle:50,prize:-1,init:function(b){a("#"+b).find(".lottery-unit").length>0&&($lottery=a("#"+b),$units=$lottery.find(".lottery-unit"),this.obj=$lottery,this.count=$units.length,$lottery.find(".lottery-unit-"+this.index).addClass("active"))},roll:function(){var b=this.index,c=this.count,d=this.obj;return a(d).find(".lottery-unit-"+b).removeClass("active"),b+=1,b>c-1&&(b=0),a(d).find(".lottery-unit-"+b).addClass("active"),this.index=b,!1},stop:function(){return f.times+=1,f.roll(),f.times>f.cycle+10&&f.prize==f.index?(clearTimeout(f.timer),f.prize=-1,f.times=0,f.click=!1,b.open({type:1,closeBtn:0,move:!1,area:["460px","370px"],title:!1,content:a(f.prizeType)}),f.giftRecord(),f.myGift()):(f.times<f.cycle?f.speed-=10:f.times==f.cycle?f.prize=f.prizeKind:f.times>f.cycle+10&&(0==f.prize&&7==f.index||f.prize==f.index+1)?f.speed+=110:f.speed+=20,f.speed<40&&(f.speed=40),f.timer=setTimeout(f.stop,f.speed)),!1},getLottery:function(){a.ajax({url:"/activity/point-draw/draw",type:"POST",dataType:"json",data:{activityCategory:"POINT_SHOP_DRAW_1000"}}).done(function(c){if(0==c.returnCode){switch(c.prize){case"POINT_SHOP_INTEREST_COUPON_2":f.prizeKind=7;break;case"POINT_SHOP_RED_ENVELOPE_10":f.prizeKind=0;break;case"POINT_SHOP_POINT_500":f.prizeKind=1;break;case"POINT_SHOP_PHONE_CHARGE_10":f.prizeKind=5;break;case"OINT_SHOP_JD_100":f.prizeKind=2;break;case"POINT_SHOP_POINT_3000":f.prizeKind=6;break;case"POINT_SHOP_INTEREST_COUPON_5":f.prizeKind=4;break;case"POINT_SHOP_RED_ENVELOPE_50":f.prizeKind=3}var d=c.prizeType.toLowerCase();a(e[d]).find(".prizeValue").text(c.prizeValue),f.speed=100,f.stop(),f.click=!0,f.prizeType=a(e[d])}else 1==c.returnCode?b.open({type:1,closeBtn:0,move:!1,area:["460px","370px"],title:!1,content:a("#nochance")}):2==c.returnCode?location.href="/login":3==c.returnCode?b.open({type:1,closeBtn:0,move:!1,area:["460px","370px"],title:!1,content:a("#expired")}):4==c.returnCode&&b.open({type:1,closeBtn:0,move:!1,area:["460px","370px"],title:!1,content:a("#authentication")})}).fail(function(){b.msg("请求失败，请重试！")})},giftRecord:function(){a.ajax({url:"/activity/point-draw/all-list",type:"GET",dataType:"json",data:{activityCategory:"POINT_SHOP_DRAW_1000"}}).done(function(b){a("#recordList").html(c("recordListTpl",{recordlist:b}))}).fail(function(){b.msg("请求失败，请重试！")})},myGift:function(){a.ajax({url:"/activity/point-draw/user-list",type:"GET",dataType:"json",data:{activityCategory:"POINT_SHOP_DRAW_1000"}}).done(function(b){a("#myRecord").html(c("myRecordTpl",{myrecord:b}))}).fail(function(){b.msg("请求失败，请重试！")})},scrollList:function(a,b){var c=a,d=c.find("li:first").height();c.find("li").length>(""!=b?b:10)&&c.animate({"margin-top":-d+"px"},600,function(){c.css({"margin-top":"0px"}).find("li:first").appendTo(c)})},hoverScrollList:function(a,b){var c,d=this;a.hover(function(){clearInterval(c)},function(){c=setInterval(function(){d.scrollList(a,b)},2e3)}).trigger("mouseout")}};a("#lotteryBox .lottery-btn").on("click",function(a){return a.preventDefault(),f.init("lotteryBox"),!f.click&&(f.getLottery(),!1)}),a(".tip-list").on("click",".go-close",function(a){a.preventDefault(),b.closeAll(),location.reload()}),f.giftRecord(),f.myGift(),f.hoverScrollList(a("#lotteryList").find(".user-record"),10)}(a)});