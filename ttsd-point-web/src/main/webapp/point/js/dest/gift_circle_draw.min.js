define(["jquery","rotate","lottery_unit","commonFun"],function(a,b,c,d){function e(b,c,e,f,g){this.bRotate=!1,this.allListURL=b,this.userListURL=c,this.drawURL=e,this.paramData=f,this.giftCircleFrame=g,this.beginLotteryDraw=function(b){this.bRotate||a.ajax({url:this.drawURL,data:this.paramData,type:"POST",dataType:"json"}).done(function(a){b(a)}).fail(function(){d.popWindow("错误","请求失败",{width:"260px"})})},this.GiftRecord=function(b){a.ajax({url:this.allListURL,data:this.paramData,type:"GET",dataType:"json"}).done(function(a){for(var c=[],d=0,e=a.length;d<e;d++)c.push("<li>恭喜"+a[d].mobile+"抽中了"+a[d].prizeValue+"</li>");this.giftCircleFrame.find(".user-record").empty().append(c.join("")),this.hoverScrollList(this.giftCircleFrame.find(".user-record"),b)}.bind(this))},this.MyGift=function(b){a.ajax({url:this.userListURL,data:this.paramData,type:"GET",dataType:"json"}).done(function(a){for(var c=[],d=0,e=a.length;d<e;d++)c.push("<li>"+a[d].prizeValue+"<time>"+a[d].lotteryTime+"</time></li>");this.giftCircleFrame.find(".own-record").empty().append(c.join("")),this.hoverScrollList(this.giftCircleFrame.find(".own-record"),b)}.bind(this))}}return e.prototype.rotateFn=function(a,b){var c=this;c.bRotate=!this.bRotate,c.giftCircleFrame.find(".rotate-btn").stopRotate(),c.giftCircleFrame.find(".rotate-btn").rotate({angle:0,animateTo:a+1800,duration:8e3,callback:function(){c.GiftRecord(),c.MyGift(),c.bRotate=!c.bRotate,c.tipWindowPop(b)}})},e.prototype.noRotateFn=function(a){this.GiftRecord(),this.MyGift(),this.tipWindowPop(a)},e.prototype.lotteryRoll=function(a,b){var d=this;c.init(a),c.initOpt.clicked||c.rollResult(function(){d.GiftRecord(),d.MyGift(),d.tipWindowPop(b)})},e.prototype.beginLuckDraw=function(a){var b=this;b.beginLotteryDraw(function(b){a&&a(b)})},e.prototype.scrollList=function(a,b){var c=a,d=c.find("li:first").height();c.find("li").length>(""!=b?b:10)&&c.animate({"margin-top":-d+"px"},600,function(){c.css({"margin-top":"0px"}).find("li:first").appendTo(c)})},e.prototype.hoverScrollList=function(a,b){var c,d=this;a.hover(function(){clearInterval(c)},function(){c=setInterval(function(){d.scrollList(a,b)},2e3)}).trigger("mouseout")},e.prototype.tipWindowPop=function(b,c){a(b).show(),d.popWindow(b.outerHTML),c&&c()},e.prototype.PrizeSwitch=function(){var b=this.giftCircleFrame.find(".gift-record").find("li"),c=this.giftCircleFrame.find(".record-list ul");b.on("click",function(b){var d=a(this),b=d.index();d.addClass("active").siblings().removeClass("active"),c.eq(b).show().siblings().hide()})},e});