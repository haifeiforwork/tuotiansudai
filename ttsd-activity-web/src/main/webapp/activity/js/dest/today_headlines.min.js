require(["jquery","layerWrapper","template","jquery.ajax.extension"],function(a,b,c){a(function(){function d(){return e.times+=1,e.roll(),e.times>e.cycle+10&&e.prize==e.index?(clearTimeout(e.timer),e.prize=-1,e.times=0,e.click=!1,setTimeout(function(){b.open({type:1,title:!1,closeBtn:0,content:a("#lotteryTip")})},1e3)):(e.times<e.cycle?e.speed-=10:e.times==e.cycle?e.prize=e.prize:e.times>e.cycle+10&&(0==e.prize&&7==e.index||e.prize==e.index+1)?e.speed+=110:e.speed+=20,e.speed<40&&(e.speed=40),e.timer=setTimeout(d,e.speed)),!1}var e=(a("#lotteryList"),{click:!1,index:-1,count:0,timer:0,speed:20,times:0,cycle:50,prize:-1,init:function(b){a("#"+b).find(".lottery-unit").length>0&&($lottery=a("#"+b),$units=$lottery.find(".lottery-unit"),this.obj=$lottery,this.count=$units.length,$lottery.find(".lottery-unit-"+this.index).addClass("active"))},roll:function(){var b=this.index,c=this.count,d=this.obj;return a(d).find(".lottery-unit-"+b).removeClass("active"),b+=1,b>c-1&&(b=0),a(d).find(".lottery-unit-"+b).addClass("active"),this.index=b,!1},stop:function(a){return this.prize=a,!1}});e.init("lottery"),a("#lottery .lottery-btn").on("click",function(f){f.preventDefault(),a.ajax({url:"/activity/isLogin",type:"GET",dataType:"json",contentType:"text/html; charset=UTF-8"}).done(function(f){if(""!=f.responseText){a("meta[name='_csrf']").remove(),a("head").append(a(f.responseText));var g=a("meta[name='_csrf']").attr("content"),h=a("meta[name='_csrf_header']").attr("content");a(document).ajaxSend(function(a,b,c){b.setRequestHeader(h,g)}),b.open({type:1,title:!1,closeBtn:0,area:["auto","auto"],content:a("#loginTip")})}else{if(e.click)return!1;a.ajax({url:"/activity/point-draw/task-draw",type:"POST",dataType:"json",data:{activityCategory:"CARNIVAL_ACTIVITY"}}).done(function(f){if(1==f.returnCode)a("#lotteryTip").html(c("lotteryTipTpl",f)),b.open({type:1,title:!1,closeBtn:0,content:a("#lotteryTip")});else if(0==f.returnCode){switch(a("#lotteryTip").html(c("lotteryTipTpl",f)),f.prize){case"M1_PHONE":e.prize=7;break;case"HUMIDIFIER":e.prize=0;break;case"HAIR_DRIER":e.prize=1;break;case"IQIYI_MEMBERSHIP_REF_CARNIVAL":e.prize=5;break;case"TELEPHONE_FARE_10_REF_CARNIVAL":e.prize=2;break;case"BAMBOO_CHARCOAL_PACKAGE":e.prize=6;break;case"INTEREST_COUPON_5_POINT_DRAW_REF_CARNIVAL":e.prize=3;break;case"RED_ENVELOPE_50_POINT_DRAW_REF_CARNIVAL":e.prize=4}e.speed=100,d(),e.click=!0}else 3==f.returnCode&&(a("#lotteryTip").html(c("lotteryTipTpl",f)),b.open({type:1,title:!1,closeBtn:0,content:a("#lotteryTip")}))}).fail(function(){b.msg("抽奖失败，请重试")})}})}),a("#lotteryTip").on("click",".close-item",function(a){a.preventDefault(),b.closeAll()})})});