require(["jquery","drawCircle","template","layerWrapper","commonFun","logintip","register_common"],function(a,b,c,d,e){function f(a,b){var c=new Date(a);c.setDate(c.getDate()+b);var d=c.getFullYear(),e=c.getMonth()+1,f=c.getDate();return d+"-"+(e<10?"0"+e:e)+"-"+(f<10?"0"+f:f)}function g(b){a.ajax({url:"/activity/lantern-festival/invest/"+b,type:"GET",dataType:"json"}).done(function(b){if(b.status){a("#investRanking-tbody").parents("table");a("#investRanking-tbody").html(c("tplTable",b))}}).fail(function(){d.msg("请求失败，请重试！")})}var h=a("#lanternFrame"),i={},j=a("#TodayAwards"),k=a("#investRanking-button"),l=a("#heroNext"),m=a("#heroPre"),n=a.trim(j.val()),o=globalFun.parseURL(location.href),p=globalFun.parseURL(location.href);"yes"==p.params.tag&&h.find(".reg-tag-current").show(),"app"==o.params.source&&a.when(e.isUserLogin()).done(function(){}).fail(function(){a(".app-list-text",h).html('当前排名：<a href="/login">登录查看</a>'),a(".app-loan-text",h).text("今日投资额：0.00元")}),h.find(".tip-list-frame .tip-list").each(function(b,c){var d=a(c).data("return");i[d]=c}),n.replace(/-/gi,"")>=parseInt(a("#activityEndTime").val().substr(0,10).replace(/-/gi,""))?l.hide():n.replace(/-/gi,"")<parseInt(a("#activityStartTime").val().substr(0,10).replace(/-/gi,""))?(m.hide(),l.hide()):n.replace(/-/gi,"")!=parseInt(a("#activityStartTime").val().substr(0,10).replace(/-/gi,""))&&n.replace(/-/gi,"")!=parseInt(a("#activityEndTime").val().substr(0,10).replace(/-/gi,""))||(m.hide(),l.hide()),k.find("span").on("click",function(b){var c,d=a("#HistoryAwards"),e=d.text();/heroPre/.test(b.target.id)?c=f(e,-1):/heroNext/.test(b.target.id)&&(c=f(e,1)),c.replace(/-/gi,"")>=parseInt(a("#activityEndTime").val().substr(0,10).replace(/-/gi,""))?l.hide():l.show(),c.replace(/-/gi,"")<=parseInt(a("#activityStartTime").val().substr(0,10).replace(/-/gi,""))?m.hide():m.show(),d.text(c),g(c)}),g(j.val()),function(b){var c=a(".reward-gift-box",h),d=a("#MobileNumber"),e="/activity/lantern-festival/all-prize-list",f="/activity/lantern-festival/user-prize-list",g="/activity/lantern-festival/prize",j="/activity/lantern-festival/drawTime",k=a(".pointer-img",c),l=d.length?d.data("mobile"):"",m={mobile:l,activityCategory:"LANTERN_FESTIVAL_ACTIVITY"};b.prototype.showDrawTime=function(){a.ajax({url:j,type:"GET",dataType:"json"}).done(function(b){a(".draw-time",c).text(b)})};var b=new b(e,f,g,m,c,3);b.GiftRecord(3),b.MyGift(3),b.showDrawTime(),k.find("img").on("click",function(){if("app"==o.params.source)location.href="/login";else{if(k.hasClass("win-result"))return;k.addClass("win-result"),setTimeout(function(){b.beginLuckDraw(function(c){if(k.removeClass("win-result"),b.showDrawTime(),0==c.returnCode){var d=c.prizeType.toLowerCase();a(i[d]).find(".prizeValue").text(c.prizeValue),b.noRotateFn(i[d])}else 1==c.returnCode?b.tipWindowPop(i.nochance):2==c.returnCode?a(".no-login-text",h).trigger("click"):3==c.returnCode?b.tipWindowPop(i.expired):4==c.returnCode&&b.tipWindowPop(i.authentication)})},1e3)}});var n=c.find(".menu-switch span");n.on("click",function(){var b=a(this),d=b.index(),e=c.find(".record-list ul");b.addClass("active").siblings().removeClass("active"),e.eq(d).show().siblings("ul").hide()})}(b),a(window).width()<700&&a(".bg-two .wp",h).append(a(".bg-two .rule-model",h))});