require(["jquery","layerWrapper","template","logintip","jquery.ajax.extension"],function(a,b,c){a(function(){function d(d,e){a.ajax({url:"/activity/newman-tyrant/"+d+"/"+e,type:"GET",dataType:"json"}).done(function(b){b.status&&a("#rankTable").html(c("rankTableTpl",b))}).fail(function(){b.msg("请求失败，请重试！")})}function e(a,b){var c=new Date(a);c.setDate(c.getDate()+b);var d=c.getFullYear(),e=c.getMonth()+1,f=c.getDate();return d+"-"+(e<10?"0"+e:e)+"-"+(f<10?"0"+f:f)}var f=a("#newmanTyrant"),g=a(".board-tab span",f),h=a("#infoDate"),i=a.trim(h.attr("data-date")).replace(/-/gi,""),j=a.trim(h.attr("data-startTime").substr(0,10)).replace(/-/gi,""),k=a.trim(h.attr("data-endTime").substr(0,10)).replace(/-/gi,""),l=a(".board-btn span",f),m=a("#heroNext"),n=a("#heroPre"),o=a("#getHistory");i==j?(n.hide(),m.hide()):i==k?m.hide():i>j&&i<k?(n.show(),m.hide()):i>k?(n.show(),m.hide()):(n.hide(),m.hide()),g.on("click",function(b){b.preventDefault();var c=a(this),e=c.attr("data-type"),f=a.trim(h.text());c.addClass("active").siblings().removeClass("active"),d(e,f)}),l.on("click",function(b){var c,f=a.trim(h.text());/heroPre/.test(b.target.id)?c=e(f,-1):/heroNext/.test(b.target.id)&&(c=e(f,1)),c.replace(/-/gi,"")==j?(n.hide(),m.show()):c.replace(/-/gi,"")==i&&c.replace(/-/gi,"")>j?(n.show(),m.hide()):c.replace(/-/gi,"")==k&&c.replace(/-/gi,"")==i?(n.show(),m.hide()):c.replace(/-/gi,"")>j&&c.replace(/-/gi,"")<i&&(n.show(),m.show()),h.text(c),d(a(".board-tab span.active").attr("data-type"),a.trim(h.text()))}),a("body").on("click",".close-tip",function(a){a.preventDefault(),b.closeAll()}),d("tyrant",a.trim(h.text())),o.on("click",function(d){d.preventDefault(),i<j?b.msg("活动暂未开始！"):i>k?b.msg("活动已结束！"):a.ajax({url:"/activity/newman-tyrant/history",type:"GET",dataType:"json"}).done(function(d){console.log(d.records),a("#historyContent").html(c("historyContentTpl",d)),b.open({type:1,closeBtn:0,move:!1,area:a(window).width()>700?["600px","auto"]:["300px","auto"],title:!1,content:a("#tipContainer")})}).fail(function(){b.msg("请求失败，请重试！")})})})});