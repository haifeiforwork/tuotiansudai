require(["underscore","jquery","layerWrapper","jquery.validate","jquery.validate.extension","jquery.form","jquery.ajax.extension"],function(a,b,c){var d=b(".register-user-form"),e=b(".fetch-captcha",d),f=b(".show-agreement",d),g=(b("#agreementInput"),b(".image-captcha-dialog")),h=b(".image-captcha-form",g),i=b(".image-captcha img"),j=b(".image-captcha-text",g),k=b(".img-change"),l=b(".image-captcha-confirm",g);b("input.login-name,input.mobile",d).on("focusout",function(a){e.removeClass("btn-normal").addClass("btn").prop("disabled",!0)}),f.click(function(){c.open({type:1,title:"拓天速贷服务协议",area:["950px","600px"],shadeClose:!0,move:!1,scrollbar:!0,skin:"register-skin",content:b("#agreementBox"),success:function(a,b){}})}),e.on("click",function(){return c.open({type:1,title:"手机验证",area:["300px","190px"],shadeClose:!0,content:b(".image-captcha-dialog"),success:function(a,c){b(".image-captcha-form label").remove(),j.val(""),m()}}),!1});var m=function(){i.attr("src","/register/user/image-captcha?"+(new Date).getTime().toString())};k.click(function(){m()}),h.validate({focusInvalid:!1,onfocusout:function(a){this.checkable(a)||this.optional(a)||this.element(a)},submitHandler:function(a){var d=this;b(a).ajaxSubmit({data:{mobile:b(".mobile").val()},dataType:"json",beforeSubmit:function(a,b,c){l.addClass("loading")},success:function(a){var b=a.data;if(!b.status||b.isRestricted)!b.status&&b.isRestricted&&d.showErrors({imageCaptcha:"短信发送频繁，请稍后再试"}),b.status||b.isRestricted||d.showErrors({imageCaptcha:"图形验证码不正确"}),d.invalid.imageCaptcha=!0,m();else{c.closeAll();var f=60,g=setInterval(function(){e.html(f+"秒后重新发送").addClass("btn disable-button").removeClass("btn-normal").prop("disabled",!0),0==f&&(clearInterval(g),e.html("重新发送").removeClass("btn disable-button").addClass("btn-normal").prop("disabled",!1)),f--},1e3)}},error:function(){d.invalid.imageCaptcha=!0,d.showErrors({imageCaptcha:"图形验证码不正确"}),m()},complete:function(){l.removeClass("loading")}})},rules:{imageCaptcha:{required:!0,regex:/^[a-zA-Z0-9]{5}$/}},messages:{imageCaptcha:{required:"请输入图形验证码",regex:"图形验证码位数不对"}}}),d.validate({focusInvalid:!1,errorPlacement:function(a,c){a.appendTo(b(".error-box"))},rules:{loginName:{required:!0,regex:/(?!^\d+$)^\w{5,25}$/,isExist:"/register/user/login-name/{0}/is-exist"},mobile:{required:!0,digits:!0,minlength:11,maxlength:11,isExist:"/register/user/mobile/{0}/is-exist"},password:{required:!0,regex:/^(?=.*[^\d])(.{6,20})$/},appCaptcha:{required:!0,digits:!0,maxlength:6,minlength:6,captchaVerify:{param:function(){var a=b('input[name="mobile"]').val();return"/register/user/mobile/"+a+"/captcha/{0}/verify"}}},agreement:{required:!0}},messages:{loginName:{required:"请输入用户名",regex:"5位至25位数字与字母下划线组合，不能全部数字",isExist:"用户名已存在"},mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",maxlength:"手机格式不正确",isExist:"手机号已存在"},password:{required:"请输入密码",regex:"6位至20位，不能全是数字"},captcha:{required:"请输入验证码"},appCaptcha:{required:"请输入手机验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",minlength:"验证码格式不正确",captchaVerify:"验证码不正确"},agreement:{required:"请同意服务协议"}},success:function(a,c){var f=b("input.login-name",d),g=b("input.mobile",d),h=b(".disable-button",d);h.length||("mobile"===c.name&&f.hasClass("valid")&&e.addClass("btn-normal").removeClass("btn").prop("disabled",!1),"loginName"===c.name&&g.hasClass("valid")&&e.addClass("btn-normal").removeClass("btn").prop("disabled",!1))}})});