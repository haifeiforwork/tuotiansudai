require(["jquery","layerWrapper","jquery.ajax.extension"],function(a,b){function c(c,d){var e={type:"POST",url:"",data:""},f=a.extend(e,c);a.ajax({type:f.type,data:f.data,url:f.url,dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){d&&d(a)}).fail(function(){b.msg("请求数据失败，请刷新页面重试！")})}a.fn.initCheckbox=function(b){return a(this).each(function(){a(this).bind("click",function(){var c=a(this),d=c.find("input:checkbox").prop("checked");d?c.addClass("on"):c.removeClass("on"),b&&b(this)})})},function(){function d(){a("#getSkipCode").val(g+"秒后可重新获取").prop("disabled",!0),a("#microPhone").css("visibility","hidden"),0==g&&(clearInterval(f),g=60,a("#getSkipCode").val("重新获取验证码").prop("disabled",!1),a("#microPhone").css("visibility","visible")),g--}var e=a("#safetySignedFrame");getUserParam=a("input.bind-data",e).data("sign"),$closed=a(".safety-status-box.closed",e),$opened=a(".safety-status-box.opened",e),getUserParam?$opened.show():$closed.show(),a("#openSafetySigned").on("click",function(){c({url:" /anxinSign/createAccount"},function(a){b.msg('<span class="layer-msg-tip"><i></i>开启成功!</span>',{skin:"msg-tip-box",time:1500,area:["290px","90px"]},function(){$closed.hide(),$opened.show()})})}),a(".init-checkbox-style",e).initCheckbox(function(b){var c=a(b).parents(".safety-status-box");if(c.hasClass("closed")){var d=a(b).hasClass("on"),e=a("#openAuthorization");d?e.prop("disabled",!1):e.prop("disabled",!0)}}),a("#openAuthorization").on("click",function(){b.open({type:1,title:"安心签免短信授权服务",area:["400px","220px"],shadeClose:!1,content:a("#getSkipPhone")})});var f,g=60;a("#getSkipPhone").on("click",function(a){var e,g=a.target.id;"getSkipCode"==g?e=!0:"microPhone"==g&&(e=!1),c({url:"anxinSign/sendCaptcha",data:{isVoice:e}},function(a){a.success?(d(),f=setInterval(d,1e3)):b.msg("请求失败，请重试或联系客服！")})}),a("#toOpenSMS").on("click",function(){a(this);c({url:"anxinSign/verifyCaptcha",data:{captcha:a("#skipPhoneCode").val(),skipAuth:!0}},function(a){a.success?b.msg('<span class="layer-msg-tip"><i></i>授权成功!</span>',{skin:"msg-tip-box",time:1500,area:["290px","90px"]},function(){location.reload()}):b.msg("请求失败，请重试或联系客服！")})})}(),function(){var d=a("#safetySignedList"),e=a(".binding-set",d),f=a(".bind-data",d).data("skipAuth");f?d.find(".sms-open").show():d.find(".sms-close").show(),a(".init-checkbox-style",d).initCheckbox(function(b){var c=a(b).hasClass("on"),d=a("#safetyToOpen ").find(".ok");c?d.prop("disabled",!1):d.prop("disabled",!0)}),e.find(".setlink").on("click",function(){var c,d=a(this),e=d.prev("i").hasClass("ok");c=a(e?"#safetyToClose":"#safetyToOpen"),b.open({type:1,title:"安心签免短信授权服务",area:["400px","200px"],shadeClose:!1,content:c})}),a(".open-safety-box",d).on("click",function(d){var e,f;a(d.target),a(this);if(/cancel/.test(d.target.className))return void b.closeAll();if(/ok/.test(d.target.className)){var g=this.id;"safetyToOpen"==g?(e=!1,f="开启成功"):"safetyToClose"==g&&(e=!0,f="关闭成功"),c({url:" /anxinSign/switchSkipAuth",data:{open:e}},function(a){a.success?b.msg(f,function(){location.reload()}):b.msg("请求失败，请重试或联系客服！")})}})}()});