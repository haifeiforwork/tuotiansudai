require(["jquery","csrf","mustache","layerWrapper","text!/tpl/point-bill-table.mustache","moment","pagination","daterangepicker"],function(a,b,c,d,e,f){a(function(){var f=a(".column-title .title-navli"),g=a("#signBtn"),h=a("#signLayer"),i=a("#closeSign"),j=a("#taskBtn"),k=a("#taskLayer"),l=a("#closeTask");f.on("click",function(b){b.preventDefault();var c=a(this),d=c.index();c.addClass("active").siblings().removeClass("active"),a(".content-list .choi-beans-list:eq("+d+")").show().siblings().hide()}),g.on("click",function(b){b.preventDefault();var c=a(this),d=a(".sign-text");$tomorrowText=a(".tomorrow-text"),$addDou=a(".add-dou"),a.ajax({url:c.data("url"),type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(b){b.data.status&&(d.html("签到成功，领取"+b.data.signInPoint+"财豆！"),$tomorrowText.html("明日可领"+b.data.nextSignInPoint+"财豆"),$addDou.html("+"+b.data.signInPoint),h.fadeIn("fast",function(){a(this).find(".add-dou").animate({bottom:"50px",opacity:"0"},800)}))})}),i.on("click",function(a){a.preventDefault(),location.href="/point"}),j.on("click",function(a){a.preventDefault(),k.fadeIn("fast")}),l.on("click",function(a){a.preventDefault(),k.fadeOut("fast")});var m=e().format("YYYY-MM-DD"),n=e().subtract(1,"week").format("YYYY-MM-DD"),o=e().subtract(1,"month").format("YYYY-MM-DD"),p=e().subtract(6,"month").format("YYYY-MM-DD"),q=a(".date-filter"),r=a(".status-filter"),s=a("#date-picker"),t=a(".pagination");s.dateRangePicker({separator:" ~ "});var u=function(){var b=a(".date-filter .select-item.current").data("day");switch(b){case 1:s.val(m+"~"+m);break;case 7:s.val(n+"~"+m);break;case 30:s.val(o+"~"+m);break;case 180:s.val(p+"~"+m);break;default:s.val("")}},v=function(c){var e=s.val().split("~"),f=a.trim(e[0])||"",g=a.trim(e[1])||"",h=a(".status-filter .select-item.current").data("status"),i={startTime:f,endTime:g,businessType:h,index:c||1};t.loadPagination(i,function(c){c.status&&_.each(c.records,function(a){switch(a.businessType){case"SIGN_IN":a.businessType="签到奖励";break;case"TASK":a.businessType="任务奖励";break;case"INVEST":a.businessType="任务奖励";break;case"EXCHANGE":a.businessType="财豆兑换"}});var e=b.render(d,c);a(".point-bill-list").html(e)})};u(),v(),q.find(".select-item").click(function(){a(this).addClass("current").siblings(".select-item").removeClass("current"),u(),v()}),r.find(".select-item").click(function(){a(this).addClass("current").siblings(".select-item").removeClass("current"),v()}),a(".apply-btn").on("click",function(b){b.preventDefault(),v(),a(".date-filter .select-item").removeClass("current")}),a(".reedom-now").on("click",function(b){b.preventDefault();var d=a(this),e=d.attr("data-id"),f=d.attr("data-bite");a(this).hasClass("no-click")||c.open({title:"温馨提示",content:"确认兑换"+f+"？",btn:["确定","取消"],yes:function(b,d){c.close(b),a.ajax({url:"/point/"+e+"/exchange",type:"POST",dataType:"json"}).done(function(a){a.status?c.alert("兑换成功！",{title:"温馨提示"}):a.status||"point insufficient"!=a.message?c.alert("兑换失败，请重试！",{title:"温馨提示"}):c.open({title:"温馨提示",content:"您的财豆不足，赚取足够多的财豆后再来兑换吧！",btn:["赚取财豆","取消"],yes:function(a,b){location.href="/point"}})}).fail(function(){c.alert("兑换失败，请重试！",{title:"温馨提示"})})}})})})});