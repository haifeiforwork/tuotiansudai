define(["jquery","underscore","layerWrapper","jquery.ajax.extension","jquery.validate","jquery.form"],function(a,b,c){var d=a(".form-login"),e=a(".login-submit",d),f=a(".login-name",d),g=a(".password",d),h=a(".captcha",d),i=a(".error",d),j=a(".image-captcha img",d),k=function(){h.val(""),j.attr("src","/login/captcha?"+(new Date).getTime().toString())};j.click(function(){k()}),f.blur(function(b){return i.text("").css("visibility","hidden"),""===a.trim(f.val())&&(i.text("用户名不能为空").css("visibility","visible"),!1)}),g.blur(function(b){return i.text("").css("visibility","hidden"),""===a.trim(g.val())&&i.text("密码不能为空").css("visibility","visible"),!1}),h.blur(function(b){return i.text("").css("visibility","hidden"),""===a.trim(h.val())&&i.text("验证码不能为空").css("visibility","visible"),!1});var l=function(){return i.text("").css("visibility","hidden"),""===a.trim(f.val())?(i.text("用户名不能为空").css("visibility","visible"),!1):""===a.trim(g.val())?(i.text("密码不能为空").css("visibility","visible"),!1):""!==a.trim(h.val())||(i.text("验证码不能为空").css("visibility","visible"),!1)},m=function(){return d.ajaxSubmit({beforeSubmit:function(a,b,c){e.addClass("loading")},success:function(a){if(a.status)window.location.href=d.data("redirect-url");else{if(k(),e.removeClass("loading"),a.isLocked)return void i.text("用户已被锁定").css("visibility","visible");if(a.isCaptchaNotMatch)return void i.text("验证码不正确").css("visibility","visible");i.text("用户或密码不正确").css("visibility","visible")}},error:function(){e.removeClass("loading"),k(),i.text("用户或密码不正确").css("visibility","visible")}}),!1};e.click(function(){l()&&m()}),a(document).keypress(function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&l()&&(e.focus(),m())}),c.open({type:1,title:!1,closeBtn:0,area:["750px","410px"],content:a("#loginTip")})});