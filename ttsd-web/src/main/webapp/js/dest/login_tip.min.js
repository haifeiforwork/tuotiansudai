define(["jquery","layerWrapper","jquery.ajax.extension","jquery.validate","jquery.form"],function(a,b){!function(){var c=a("#loginTip"),d=a(".form-login",c),e=(a(".login-submit",c),a(".captcha",c)),f=(a("i.error",c),a(".image-captcha img",c)),g=function(){e.val(""),f.attr("src","/login/captcha?"+(new Date).getTime().toString())};f.click(function(){g()});d.validate({debug:!0,rules:{username:{required:!0},password:{required:!0},captcha:{required:!0,minlength:5}},messages:{username:{required:"用户名不能为空"},password:{required:"密码不能为空"},captcha:{required:"验证码不能为空",minlength:"验证码不正确"}},errorPlacement:function(a,b){a.appendTo(b.parent())},submitHandler:function(a){a.submit()}}),a(".close-btn",c).on("click",function(a){a.preventDefault(),b.closeAll()}),a("body").on("click",".show-login",function(d){d.preventDefault(),g(),a.ajax({url:"/isLogin",type:"GET",dataType:"json",contentType:"application/json; charset=UTF-8"}).fail(function(d){if(""!=d.responseText){var e=a("head");e.find("meta[name='_csrf']").remove().append(a(d.responseText));var f=e.find("meta[name='_csrf']").attr("content"),g=e.find("meta[name='_csrf_header']").attr("content");a(document).ajaxSend(function(a,b,c){b.setRequestHeader(g,f)}),b.open({type:1,title:!1,closeBtn:0,area:["auto","auto"],content:c})}})})}()});