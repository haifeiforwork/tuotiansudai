require(["jquery","mustache","text!/tpl/loaner_loan_table.tpl","moment","daterangepicker"],function(a,b,c,d){function e(d){var e=a("#daterangepicker").val().split("~"),f=a.trim(e[0]),h=a.trim(e[1]),i=a(".query-type").find(".current").attr("data-value"),j="";if(i&&(j="&status="+i),""==f||"undefined"==f)var k=API_AJAX+"?index="+d+j;else var k=API_AJAX+"?startTime="+f+"&endTime="+h+"&index="+d+j;a.ajax({url:k,type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(d){if("REPAYING"==i){d.step1=!0;var e='<a class="re_plan" href="">提前还款</a>';a(".jq-re-plan").append(e)}else"COMPLETE"==i?d.step2=!0:d.step3=!0;var f=b.render(c,d);a("#tpl").html(f),g=d.data.index,a("#tpl .plan").click(function(){var b=a(this).attr("data-loan"),c="";return a.ajax({url:b,type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(b){if(b.data.status){for(var d=b.data.records,e=0;e<d.length;e++){if("REPAYING"==i)if(d[e].isEnabled)var f='<a class="re_plan" href = "">待还款</a>';else var f="待还款";if("COMPLETE"==i){var f="完成";a(".re_plan").remove()}if(""==d[e].actualRepayDate||null==d[e].actualRepayDate)var g="--";else var g=d[e].actualRepayDate;c+="<tr><td>"+d[e].period+"</td><td>"+d[e].corpus+"</td><td>"+d[e].expectedInterest+"</td><td>"+d[e].expectedInterest+"</td> <td>"+d[e].defaultInterest+"</td> <td>"+d[e].repayDate+"</td> <td>"+d[e].actualInterest+"</td> <td>"+g+"</td><td>"+f+"</td></tr>"}a(".table-list tbody").find("tr").remove(),a(".table-list tbody").append(c)}}),a(".layer-box").show(),!1})})}function f(){var b=a(".start-end span.current").attr("day");b?1==b?a("#daterangepicker").val(h+"~"+h):7==b?a("#daterangepicker").val(i+"~"+h):30==b?a("#daterangepicker").val(j+"~"+h):a("#daterangepicker").val(k+"~"+h):a("#daterangepicker").val(""),e(1)}var g,h=d().format("YYYY-MM-DD"),i=d().subtract(1,"week").format("YYYY-MM-DD"),j=d().subtract(1,"month").format("YYYY-MM-DD"),k=d().subtract(6,"month").format("YYYY-MM-DD");a("#daterangepicker").dateRangePicker({separator:" ~ "}).val(h+"~"+h),e(1),a(".start-end .jq-n").click(function(){a(this).addClass("current").siblings(".jq-n").removeClass("current"),f()}),a(".query-type .jq-n").click(function(){a(this).addClass("current").siblings(".jq-n").removeClass("current"),e(1)}),a(".apply-btn").click(function(){e(1)}),a(document).on("click",".pagination .nextPage",function(){g++,e(g)}),a(document).on("click",".pagination .prevPage",function(){g--,e(g)}),a(".layer-box .close").click(function(){return a(".layer-box").hide(),!1}),a(".layer-fix").click(function(){a(".layer-box").hide()})});