require(["jquery","mustache","text!/tpl/fundtable.tpl","moment","daterangepicker"],function(a,b,c,d){function e(){var b=a(".start-end span.current").attr("day");b?1==b?a("#daterangepicker").val(_now_day+"~"+_now_day):7==b?a("#daterangepicker").val(_week+"~"+_now_day):30==b?a("#daterangepicker").val(_month+"~"+_now_day):a("#daterangepicker").val(_sixMonth+"~"+_now_day):a("#daterangepicker").val(""),getAjax(1)}var f,g=d().format("YYYY-MM-DD"),h=d().subtract(1,"week").format("YYYY-MM-DD"),i=d().subtract(1,"month").format("YYYY-MM-DD"),j=d().subtract(6,"month").format("YYYY-MM-DD"),k=a("#date-picker"),l=a(".pagination");k.dateRangePicker({separator:" ~ "}).val(g+"~"+g);var m=function(){var b=a(".date-filter .select-item.current").data("day");switch(b){case 1:k.val(g+"~"+g);break;case 7:k.val(h+"~"+g);break;case 30:k.val(i+"~"+g);break;case 180:k.val(j+"~"+g);break;default:k.val("")}};a(".date-filter .select-item").click(function(){a(this).addClass("current").siblings(".select-item").removeClass("current"),m(),n()}),a(".status-filter .select-item").click(function(){a(this).addClass("current").siblings(".select-item").removeClass("current"),n()}),a(".apply-btn").click(function(){n()});var n=function(c){var d=k.val().split("~"),e=a.trim(d[0])||"",f=a.trim(d[1])||"",g=a(".status-filter .select-item.current").data("status"),h={startTime:e,endTime:f,status:g,index:c||1};l.loadPagination(h,function(c){var d=b.render(investListTemplate,c);a(".invest-list").html(d),a(".invest-list .show-invest-repay").click(function(){a.ajax({url:a(this).data("url"),type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).success(function(c){var d=c.data;if(d.isLoanCompleted="COMPLETE"==g,d.csrfToken=a("meta[name='_csrf']").attr("content"),d.status){_.each(d.records,function(a){switch(d.loanId=a.loanId,a.loanRepayStatus){case"REPAYING":a.status="待还";break;case"COMPLETE":a.status="完成";break;case"CANCEL":a.status="流标";break;case"CONFIRMING":a.status="确认中"}});var e=b.render(investRepayTemplate,d);layer.open({type:1,title:!1,offset:"100px",area:["1000px"],shadeClose:!0,content:e})}})})})};getAjax(1),a(".start-end .jq-n").click(function(){a(this).addClass("current").siblings(".jq-n").removeClass("current"),e()}),a(".query-type .jq-n").click(function(){a(this).addClass("current").siblings(".jq-n").removeClass("current"),getAjax(1)}),a(".apply-btn").click(function(){getAjax(1)}),a(document).on("click",".pagination .nextPage",function(){f++,getAjax(f)}),a(document).on("click",".pagination .prevPage",function(){f--,getAjax(f)})});