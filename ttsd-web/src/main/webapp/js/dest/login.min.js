require(["jquery","underscore","jquery.ajax.extension","jquery.validate","jquery.form"],function(a,b){!function(){function c(){h.val(""),j.attr("src","/login/captcha?"+(new Date).getTime().toString())}function d(c){c.each(function(c,d){var e,f=d.name,g=a.trim(d.value);switch(k=!0,f){case"username":b.isEmpty(g)&&(e="用户名不能为空",k=!1);break;case"password":b.isEmpty(g)&&(e="密码不能为空",k=!1);break;case"captcha":b.isEmpty(g)&&(e="验证码不能为空",k=!1)}k||i.text(e).css("visibility","visible")})}var e=a("#loginContainer"),f=a(".form-login",e),g=a(".login-submit",f),h=a(".captcha",f),i=a(".error",f),j=a(".image-captcha img",f),k=!0;c(),j.click(function(){c()}),f.find("input:text,input:password").on("blur",function(){var b=a(this);i.text("").css("visibility","hidden"),d(b)});var l=function(){return f.ajaxSubmit({beforeSubmit:function(a,b,c){g.addClass("loading")},success:function(a){a.status?window.location.href=b.difference(a.roles,["USER"]).length>0?f.data("redirect-url"):"/register/account":(c(),g.removeClass("loading"),i.text(a.message).css("visibility","visible"))},error:function(){g.removeClass("loading"),c(),i.text("用户或密码不正确").css("visibility","visible")}}),!1};g.click(function(a){a.preventDefault(),d(f.find("input:text,input:password")),k&&l()}),a(document).keypress(function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&k?(g.focus(),a.preventDefault(),l()):d(f.find("input:text,input:password"))})}()});