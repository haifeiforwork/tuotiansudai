require(["jquery","underscore","jquery.ajax.extension","jquery.validate","jquery.form"],function(a,b){!function(){var c=a("#loginContainer"),d=a(".form-login",c),e=a(".login-submit",d),f=a(".captcha",d),g=a(".error",d),h=a(".image-captcha img",d),i=!1,j=function(){f.val(""),h.attr("src","/login/captcha?"+(new Date).getTime().toString())};j(),h.click(function(){j()}),a.fn.checkLogin=function(){return a(this).each(function(c,d){var e,f=d.name,h=a.trim(d.value);switch(i=!0,f){case"username":b.isEmpty(h)&&(e="用户名不能为空",g.text(e).css("visibility","visible"),i=!1);break;case"password":b.isEmpty(h)&&(e="密码不能为空",g.text(e).css("visibility","visible"),i=!1);break;case"captcha":b.isEmpty(h)&&(e="验证码不能为空",g.text(e).css("visibility","visible"),i=!1)}})},d.find("input:text,input:password").on("blur",function(){var b=a(this);g.text("").css("visibility","hidden"),b.checkLogin()});var k=function(){return d.ajaxSubmit({beforeSubmit:function(a,b,c){e.addClass("loading")},success:function(a){a.status?window.location.href=b.difference(a.roles,["USER"]).length>0?d.data("redirect-url"):"/register/account":(j(),e.removeClass("loading"),g.text(a.message).css("visibility","visible"),i=!1)},error:function(){e.removeClass("loading"),j(),g.text("用户或密码不正确").css("visibility","visible"),i=!1}}),!1};e.click(function(a){a.preventDefault(),d.find("input:text,input:password").checkLogin(),i&&k()}),a(document).keypress(function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&i?(e.focus(),a.preventDefault(),k()):d.find("input:text,input:password").checkLogin()})}()});