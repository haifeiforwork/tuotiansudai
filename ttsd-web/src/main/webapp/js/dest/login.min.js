require(["jquery","csrf","jquery.validate","jquery.form"],function(a){a(function(){var b=a(".form-login"),c=a(".login-submit",b),d=a(".login-name",b),e=a(".password",b),f=a(".captcha",b),g=a(".error",b),h=a(".image-captcha img",b),i=!1,j=!1,k=!1,l=function(){k=!1,f.val(""),h.attr("src","/login/captcha?"+(new Date).getTime().toString()),m()};h.click(function(){l()}),d.keyup(function(b){var c="用户名不能为空",e=d.val().trim(),f=[9,13,16,17,18,20,35,36,37,38,39,40,45,144,225];return g.text("").css("visibility","hidden"),""!==e&&-1===a.inArray(b.keyCode,f)&&(i=!0),""===e&&-1===a.inArray(b.keyCode,f)&&(g.text(c).css("visibility","visible"),i=!1),m(),!0}),e.keyup(function(b){var c="密码不能为空",d=e.val().trim(),f=[9,13,16,17,18,20,35,36,37,38,39,40,45,144,225];g.text("").css("visibility","hidden"),""!==d&&-1===a.inArray(b.keyCode,f)&&(j=!0),""===d&&-1===a.inArray(b.keyCode,f)&&(g.text(c).css("visibility","visible"),j=!1),m()}),f.keyup(function(b){var c=f.val().trim(),d=[9,13,16,17,18,20,35,36,37,38,39,40,45,144,225];return g.text("").css("visibility","hidden"),5===c.length&&-1===a.inArray(b.keyCode,d)?void a.ajax({url:"/login/captcha/"+c+"/verify",type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).success(function(a){a.data.status?k=!0:(g.text("验证码不正确").css("visibility","visible"),k=!1)}).error(function(){k=!1}).complete(function(){m()}):(k=!1,""===c&&-1===a.inArray(b.keyCode,d)&&(g.text("验证码不能为空").css("visibility","visible"),k=!1,m()),c.length<5&&-1===a.inArray(b.keyCode,d)&&(k=!1),void m())});var m=function(){var a=i&&j&&k;return a?g.text("").css("visibility","hidden"):g.text("账号、密码和验证码不能为空").css("visibility","visible"),a},n=function(){return b.ajaxSubmit({beforeSubmit:function(a,b,d){c.toggleClass("loading")},success:function(a){a.data.status?window.location.href=b.data("redirect-url"):a.data.isLocked?g.text("用户已被锁定").css("visibility","visible"):g.text("用户或密码不正确").css("visibility","visible")},error:function(){g.text("用户或密码不正确").css("visibility","visible")},complete:function(){l(),c.toggleClass("loading"),m()}}),!1};c.click(function(){m()&&n()}),a(document).keypress(function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&m()&&n()})})});