require(["jquery","csrf"],function(a){a(function(){var b=/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$/;a(".phone-txt").blur(function(){var c=a(this);if(11==a(this).val().length&&b.test(a(this).val())){var d=a(this).val();a.get("/mobile-retrieve-password/mobile/"+d+"/is-exist?random="+(new Date).getTime(),function(b){b.data.status?(c.addClass("valid-ok"),a(".send-yzm").removeAttr("disabled").removeClass("grey"),a(".error").html(""),a(".yzm").hasClass("valid-ok")?a(".btn-send-form").removeAttr("disabled").removeClass("grey"):a(".btn-send-form").attr("disabled","disabled").addClass("grey")):(c.removeClass("valid-ok"),a(".error").html("手机号格式不合法或手机不存在"),a(".send-yzm").attr("disabled","disabled").addClass("grey"))})}else c.removeClass("valid-ok"),a(".error").html("手机号格式不合法或手机不存在"),a(".send-yzm").attr("disabled","disabled").addClass("grey")}),a(".yzm-txt").blur(function(){var b=a(this);if(6==a(this).val().length){var c=a(".phone-txt").val(),d=a(this).val();a.get("/mobile-retrieve-password/mobile/"+c+"/captcha/"+d+"/verify?random="+(new Date).getTime(),function(c){c.data.status?(b.closest(".yzm").addClass("valid-ok"),a(".error").html(""),a(".phone-txt").hasClass("valid-ok")?a(".btn-send-form").removeAttr("disabled").removeClass("grey"):a(".btn-send-form").attr("disabled","disabled").addClass("grey")):(b.closest(".yzm").removeClass("valid-ok"),a(".error").html("验证码不正确"),a(".btn-send-form").attr("disabled","disabled").addClass("grey"))})}else b.closest(".yzm").removeClass("valid-ok"),a(".error").html("验证码不正确"),a(".btn-send-form").attr("disabled","disabled").addClass("grey")}),a(".fetch-captcha").on("click",function(){a(".verification-code-text").val(""),a(".layer-box").show(),c()}),a(".close").on("click",function(){a(".layer-box").hide()}),a(".complete").click(function(){var b=a(".phone-txt").val(),d=a(".verification-code-text").val();a.ajax({url:"/mobile-retrieve-password/mobile/"+b+"/captcha/"+d+"/send-mobile-captcha",type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(b){function d(){a(".fetch-captcha").html(e+"秒后重新发送").addClass("grey"),0==e&&(clearInterval(f),a(".fetch-captcha").html("重新发送").removeClass("grey"),a(".complete").addClass("grey").attr("disabled","disabled"),a(".verification-code-text").val("")),e--}if(b.data.status){var e=30,f=setInterval(d,1e3);a(".layer-box").hide(),a(".verification-code-main b").hide(),a(".verification-code-main b").html("验证码输入错误")}else b.data.isRestricted&&(a(".verification-code-main b").html("短信发送频繁，请稍后再试"),a(".verification-code-main b").css("display","inline-block"),c())})});var c=function(){var b=a(".verification-code-img");b.attr("src","/mobile-retrieve-password/image-captcha?"+(new Date).toTimeString())};a(".verification-code-img").click(function(){c()}),a(".verification-code-text").blur(function(){var b=a(this),d=b.val();d.length<5?(a(".verification-code-main b").css("display","inline-block"),a(".verification-code-main b").html("验证码输入错误"),a(".complete").addClass("grey").attr("disabled","disabled")):a.ajax({url:"/mobile-retrieve-password/image-captcha/"+d+"/verify",type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(b){b.data.status?(a(".verification-code-main b").hide(),a(".complete").removeClass("grey").removeAttr("disabled")):(a(".verification-code-main b").css("display","inline-block"),a(".verification-code-main b").html("验证码输入错误"),a(".complete").addClass("grey").attr("disabled","disabled"),c())})}),a(".btn-send-form").click(function(){var b=a(".phone-txt").val(),c=a(".yzm-txt").val();window.location.href="/mobile-retrieve-password/mobile/"+b+"/captcha/"+c+"/new-password-page"})})});