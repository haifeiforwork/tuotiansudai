require(["jquery","layer","csrf"],function(a,b){a(function(){var c=/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$/;a(".phone-txt").blur(function(){var b=a(this);if(11==a(this).val().length&&c.test(a(this).val())){var d=a(this).val();a.get("/mobile-retrieve-password/mobile/"+d+"/is-exist?random="+(new Date).getTime(),function(c){c.data.status?(b.addClass("valid-ok"),a(".send-yzm").removeAttr("disabled").removeClass("grey"),a(".error").html(""),a(".yzm").hasClass("valid-ok")?a(".btn-send-form").removeAttr("disabled").removeClass("grey"):a(".btn-send-form").attr("disabled","disabled").addClass("grey")):(b.removeClass("valid-ok"),a(".error").html("手机号格式不合法或手机不存在"),a(".send-yzm").attr("disabled","disabled").addClass("grey"))})}else b.removeClass("valid-ok"),a(".error").html("手机号格式不合法或手机不存在"),a(".send-yzm").attr("disabled","disabled").addClass("grey")}),a(".yzm-txt").blur(function(){var b=a(this);if(6==a(this).val().length){var c=a(".phone-txt").val(),d=a(this).val();a.get("/mobile-retrieve-password/mobile/"+c+"/captcha/"+d+"/verify?random="+(new Date).getTime(),function(c){c.data.status?(b.closest(".yzm").addClass("valid-ok"),a(".error").html(""),a(".phone-txt").hasClass("valid-ok")?a(".btn-send-form").removeAttr("disabled").removeClass("grey"):a(".btn-send-form").attr("disabled","disabled").addClass("grey")):(b.closest(".yzm").removeClass("valid-ok"),a(".error").html("验证码不正确"),a(".btn-send-form").attr("disabled","disabled").addClass("grey"))})}else b.closest(".yzm").removeClass("valid-ok"),a(".error").html("验证码不正确"),a(".btn-send-form").attr("disabled","disabled").addClass("grey")}),a(".fetch-captcha").on("click",function(){return a(".verification-code-main b").hide(),a(".verification-code-text").val(""),b.open({type:1,title:"输入图形验证码",area:["542px","244px"],shadeClose:!0,offset:"146px",scrollbar:!1,content:a(".layer-box"),success:function(a,b){d()}}),!1}),a(".complete").click(function(){var c=a(".phone-txt").val(),e=a(".verification-code-text").val();e.length<5?(a(".verification-code-main b").html("验证码不正确").show(),d()):a.ajax({url:"/mobile-retrieve-password/mobile/"+c+"/imageCaptcha/"+e+"/send-mobile-captcha",type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(c){function e(){a(".fetch-captcha").html(f+"秒后重新发送").addClass("grey"),a(".fetch-captcha").attr("disabled","disabled"),0==f&&(clearInterval(g),a(".fetch-captcha").html("重新发送").removeClass("grey"),a(".fetch-captcha").removeAttr("disabled","disabled"),a(".verification-code-text").val("")),f--}if(c.data.status){var f=30,g=setInterval(e,1e3);b.closeAll()}else c.data.isRestricted?(a(".verification-code-main b").html("短信发送频繁，请稍后再试").show(),d()):(a(".verification-code-main b").html("验证码不正确").show(),d())})});var d=function(){var b=a(".verification-code-img");b.attr("src","/mobile-retrieve-password/image-captcha?"+(new Date).toTimeString())};a(".verification-code-img").click(function(){d()}),a(".btn-send-form").click(function(){var b=a(".phone-txt").val(),c=a(".yzm-txt").val();window.location.href="/mobile-retrieve-password/mobile/"+b+"/captcha/"+c+"/new-password-page"})})});