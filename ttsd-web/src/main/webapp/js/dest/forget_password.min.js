require(["jquery","layerWrapper","jquery.validate","jquery.validate.extension","jquery.form","csrf"],function(a,b){var c=a("#retrievePasswordBox"),d=a(".retrieve-form",c),e=(a(".btn-send-form",c),a(".fetch-captcha",c)),f=a(".verification-code-main"),g=a(".image-captcha-confirm",f);d.validate({focusInvalid:!1,rules:{mobile:{required:!0,digits:!0,minlength:11,maxlength:11,isNotExist:"/mobile-retrieve-password/mobile/{0}/is-exist?random="+(new Date).getTime()},captcha:{required:!0,digits:!0,maxlength:6,captchaVerify:{param:function(){var b=a('input[name="mobile"]').val();return"/mobile-retrieve-password/mobile/"+b+"/captcha/{0}/verify?random="+(new Date).getTime()}}}},messages:{mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",maxlength:"手机格式不正确",isNotExist:"手机号不存在"},captcha:{required:"请输入验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",captchaVerify:"验证码不正确"}},showErrors:function(a,b){this.__proto__.defaultShowErrors.call(this),a.mobile&&e.prop("disabled",!0).removeClass("btn-success")},success:function(a,b){"mobile"===b.name&&e.prop("disabled",!1).addClass("btn-success")},submitHandler:function(b){var c=a(".phone-txt").val(),d=a(".yzm-txt").val();window.location.href="/mobile-retrieve-password/mobile/"+c+"/captcha/"+d+"/new-password-page"}}),e.on("click",function(){return a(".verification-code-main b").hide(),a(".verification-code-text").val(""),b.open({type:1,title:"输入图形验证码",area:["380px","200px"],shadeClose:!0,offset:"146px",content:a(".verification-code-main"),success:function(a,b){h()}}),!1}),g.click(function(){var c=a(".phone-txt").val(),d=a(".verification-code-text").val();d.length<5?(a(".verification-code-main b").html("验证码不正确").show(),h()):a.ajax({url:"/mobile-retrieve-password/mobile/"+c+"/imageCaptcha/"+d+"/send-mobile-captcha",type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(c){function d(){e.html(f+"秒后重新发送").prop("disabled",!0).removeClass("btn-success"),0==f&&(clearInterval(g),e.html("重新发送").prop("disabled",!1).addClass("btn-success"),a(".verification-code-text").val("")),f--}if(c.data.status){var f=30,g=setInterval(d,1e3);b.closeAll()}else c.data.isRestricted?(a(".verification-code-main b").html("短信发送频繁，请稍后再试").show(),h()):(a(".verification-code-main b").html("验证码不正确").show(),h())})});var h=function(){var b=a(".verification-code-img");b.attr("src","/mobile-retrieve-password/image-captcha?"+(new Date).toTimeString())};a(".verification-code-img").click(function(){h()})});