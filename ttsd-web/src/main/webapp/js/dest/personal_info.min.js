require(["jquery","layerWrapper","jquery.validate","jquery.validate.extension","csrf","jquery.form"],function(a,b){function c(a){0==y?(a.prop("disabled",!1).text("重新发送"),y=30):(a.prop("disabled",!0).text(""+y+"s后重新发送"),y--,setTimeout(function(){c(a)},1e3))}var d=a("#personInfoBox"),e=a(".setEmail",d),f=a(".setTurnOnNoPasswordInvest",d),g=a(".setTurnOffNoPasswordInvest",d),h=a(".setPass",d),i=a(".setUmpayPass",d),j=a("#changeEmailDOM"),k=a("#turnOnNoPasswordInvestDOM"),l=a("#turnOffNoPasswordInvestDOM"),m=a("#noPasswordInvestDOM"),n=a(".image-captcha",l),o=(a(".image-captcha-text",l),a(".get-captcha")),p=a("#changePassDOM"),q=a("#resetUmpayPassDOM"),r=a("#successUmpayPass"),s=a(".setNoPasswordInvest"),t=a("form",j),u=a("form",p),v=a("form",q),w=a("form",k),x=a("form",l);e.on("click",function(){b.open({type:1,move:!1,offset:"200px",title:"绑定邮箱",area:["490px","220px"],shadeClose:!0,content:j,cancel:function(){t.validate().resetForm()}})}),f.on("click",function(){b.open({type:1,move:!1,offset:"200px",title:"免密投资",area:["490px","220px"],shadeClose:!1,closeBtn:0,btn:["取消","去联动优势授权"],content:k,btn1:function(){},btn2:function(){w.submit(),b.open({type:1,move:!1,offset:"200px",title:"免密投资",area:["490px","220px"],shadeClose:!0,content:m})}})}),g.on("click",function(){b.open({type:1,move:!1,area:"500px",title:"免密投资",closeBtn:0,btn:["取消","我要关闭"],shadeClose:!1,content:l,btn1:function(){},btn2:function(){}})}),o.on("click",function(){c(a(this))}),s.on("click",function(){var b=a(this);a.ajax({url:b.data("url"),type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){a.data.status&&(location.href="/personal-info")})});var y=30;x.validate({focusInvalid:!1,onFocusOut:function(a){this.checkable(a)||this.optional(a)||this.element(a)},errorPlacement:function(a,b){a.appendTo(b.parent())},rules:{imageCaptcha:{required:!0,regex:/^[a-zA-Z0-9]{5}$/}},messages:{imageCaptcha:{required:"请输入图形验证码",regex:"图形验证码位数不对"}}}),t.validate({focusInvalid:!1,rules:{email:{required:!0,regex:/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,email:!0,isExist:"/personal-info/email/{0}/is-exist"}},onkeyup:function(b,c){var d=[16,17,18,20,35,36,37,38,39,40,45,144,225];9===c.which&&""===this.elementValue(b)||-1!==a.inArray(c.keyCode,d)||this.element(b)},onFocusOut:function(a){this.checkable(a)||this.optional(a)||this.element(a)},messages:{email:{required:"请输入有效邮箱",regex:"请输入有效邮箱",isExist:"邮箱已存在",email:"请输入有效邮箱"}},success:"valid",submitHandler:function(c){return a(c).ajaxSubmit({dataType:"json",beforeSubmit:function(c,d,e){a(".change-email-success .email").html(a('input[name="email"]').val()),d.resetForm(),b.closeAll()},success:function(c){var d=c.data;d.status?b.open({type:1,title:"验证邮箱",area:["500px","220px"],shadeClose:!0,content:a("#change-email-success"),btn:["返回"],yes:function(a,c){b.close(a)}}):b.msg("邮箱绑定失败，请重试！",{type:1,time:2e3})},error:function(){b.msg("邮箱绑定失败，请重试！",{type:1,time:2e3})},complete:function(){}}),!1}}),h.on("click",function(){b.open({type:1,move:!1,offset:"200px",title:"修改密码",area:["500px","300px"],shadeClose:!1,content:p,cancel:function(){u.validate().resetForm()}})}),u.validate({focusCleanup:!0,focusInvalid:!1,onkeyup:function(b,c){var d=[16,17,18,20,35,36,37,38,39,40,45,144,225];9===c.which&&""===this.elementValue(b)||-1!==a.inArray(c.keyCode,d)||this.element(b)},onFocusOut:function(a){this.checkable(a)||this.optional(a)||this.element(a)},submitHandler:function(c){var d=this;return a(c).ajaxSubmit({dataType:"json",beforeSubmit:function(a,c,e){d.resetForm(),b.closeAll()},success:function(c){var d=c.data;d.status?b.msg("密码修改成功，请重新登录！",{type:1,time:2e3},function(){a(".header .logout-form").submit()}):b.msg("密码修改失败，请重试！",{type:1,time:2e3})},error:function(){b.msg("密码修改失败，请重试！",{type:1,time:2e3})},complete:function(){}}),!1},rules:{originalPassword:{required:!0,rangelength:[6,20],regex:/^(?=.*[^\d])(.{6,20})$/,isNotExist:"/personal-info/password/{0}/is-exist"},newPassword:{required:!0,rangelength:[6,20],regex:/^(?=.*[^\d])(.{6,20})$/},newPasswordConfirm:{required:!0,rangelength:[6,20],regex:/^(?=.*[^\d])(.{6,20})$/,equalTo:"input[name='newPassword']"}},messages:{originalPassword:{required:"请输入原密码",rangelength:"长度6~20位",regex:"不能全为数字",isNotExist:"原密码不正确"},newPassword:{required:"请输入新密码",rangelength:"长度6~20位",regex:"不能全为数字"},newPasswordConfirm:{required:"请输入新密码",rangelength:"长度6~20位",regex:"不能全为数字",equalTo:"密码不一致"}}}),i.on("click",function(){b.open({type:1,move:!1,offset:"200px",title:"修改支付密码",area:["500px","300px"],shadeClose:!1,content:q,cancel:function(){v.validate().resetForm(),a(".identityCodeTitle").show(),a(".identityCodeError").hide()}})}),v.validate({submitHandler:function(c){var d=this;return a(c).ajaxSubmit({dataType:"json",beforeSubmit:function(a,b,c){d.resetForm()},success:function(c){var d=c.data;d.status?(b.closeAll(),b.open({type:1,move:!1,offset:"200px",title:"修改支付密码",area:["500px","300px"],shadeClose:!1,content:r})):(a(".identityCodeTitle").hide(),a(".identityCodeError").show())},error:function(){a(".identityCodeTitle").hide(),a(".identityCodeError").show()},complete:function(){}}),!1},rules:{identityNumber:{required:!0}},messages:{identityNumber:{required:"请输入身份证"}}});var z=function(){n.attr("src","/register/user/image-captcha?"+(new Date).getTime().toString())};n.click(function(){z()}),a("#readUmpayPass").on("click",function(){b.closeAll()})});