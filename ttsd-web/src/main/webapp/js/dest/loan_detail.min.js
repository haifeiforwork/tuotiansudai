require(["jquery","pagination","mustache","text!/tpl/loan-invest-list.mustache","layerWrapper","csrf","autoNumeric"],function(a,b,c,d,e){function f(a){var b=n.find(":checkbox");b.is(":checked")&&g()}function g(){var a=parseFloat(o.html());Math.round(100*(a+amount))}var h=a(".loan-detail-content"),i=a(".text-input-amount",h),j=a(".account-info",h),k=a(".btn-pay",j),l=a(".loan-nav li"),m=a(".loan-list",h),n=(a("#picListBox"),a(".experience-ticket",h)),o=a(".experience-interest",h),p=a(".pagination",h),q=a(".errorTip");i.autoNumeric("init"),e.ready(function(){e.photos({photos:"#picListBox"})});var r=h.data("loan-progress");50>=r?(a(".chart-box .rount").css("webkitTransform","rotate("+3.6*r+"deg)"),a(".chart-box .rount2").hide()):(a(".chart-box .rount").css("webkitTransform","rotate(180deg)"),a(".chart-box .rount2").show(),a(".chart-box .rount2").css("webkitTransform","rotate("+3.6*(r-50)+"deg)"));var s=function(b){var e={index:b||1};p.loadPagination(e,function(b){if(b.status){var e=c.render(d,b);a(".loan-list-con table").html(e)}})};if(m.find(".loan-list-con").eq(0).show(),l.click(function(){var b=a(this);b.addClass("active").siblings("li").removeClass("active");var c=b.index();1===c&&s(),m.find(".loan-list-con").eq(c).show().siblings(".loan-list-con").hide()}),"PREHEAT"===h.data("loan-status")){var t=h.data("loan-countdown");window.setInterval(function(){var b=0,c=0,d=0,e=0;1800>=t&&(t>0?(d=Math.floor(t/60)-24*b*60-60*c,e=Math.floor(t)-24*b*60*60-60*c*60-60*d):(k.prop("disabled",!1),k.html("马上投资"),j.find(".time-item").remove(),j.find(".expected-interest").parents("dd").removeClass("hide")),9>=d&&(d="0"+d),9>=e&&(e="0"+e),a("#minute_show").html(d+"分"),a("#second_show").html(e+"秒"),t--)},1e3)}if(i.length){var u="INVESTOR"===h.data("user-role"),v=a(".ticket-list"),w=a("#use-experience-ticket");n.is(":hidden")?a(".account-list").find("dd").last().css({"margin-top":"20px"}):n.find(":checkbox").on("click",function(){var b,c=a(this);b=c.is(":checked"),b?(n.next("dd.experience-revenue").show(),g()):n.next("dd.experience-revenue").hide()});var x=function(b){var c=a(".hid-loan").val(),d=parseFloat(i.autoNumeric("get"));isNaN(d)&&(d="0.00");var g=a("form .amountNeedRaised-i").text();if(Number(g)<Number(d)||0>=d){var h;return h=0>=d?"输入金额不能等于0!":"输入金额不能大于可投金额!",e.tips('<i class="fa fa-times-circle"></i>'+h,".text-input-amount",{tips:[1,"#ff7200"],time:0}),void k.prop("disabled",!0)}e.closeAll("tips"),k.prop("disabled",!1),v.find(".ticket-title").filter(function(b,c){return a(c).attr("data-income")>d}).parents("li").addClass("disabled"),a.ajax({url:"/calculate-expected-interest/loan/"+c+"/amount/"+d,type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){b||e.closeAll("tips"),f(a),k.prop("disabled",!1)})};u&&x(!0),i.blur(function(){x(!1)}),i.keypress(function(a){v.find("input").prop("checked",!1),w.find("span").text("请点击选择优惠券")}),a("form").submit(function(){var b=a(this);if("/invest"===b.attr("action")){if(!user_can_invest)return location.href="/login?redirect="+encodeURIComponent(location.href),!1;var c=parseFloat(i.autoNumeric("get"));if(isNaN(parseFloat(c)))return!1;var d=parseFloat(a("form .account-amount").text());return c>d?(location.href="/recharge",!1):(i.val(c),!0)}return!0}),w.click(function(b){var c=a(this);return c.hasClass("disabled")?!1:(v.toggleClass("hide"),c.find(".fa-sort-down").toggleClass("hide").siblings(".fa-sort-up").toggleClass("hide"),void(b.stopPropagation?b.stopPropagation():window.event&&(window.event.cancelBubble=!0)))}),v.find("input").click(function(b){var c=a.trim(a(b.target).next().find(".ticket-title").text());w.find("span").text(c)}),a("body").click(function(b){var c=b||window.event,d=c.srcElement||c.target;v.hasClass("hide")||0!=a(d).parents(".ticket-list").length||v.addClass("hide")}),a("#use-experience-ticket").click(function(b){var c=a(this),d=this.value,f=c.prop("checked"),g=parseFloat(i.autoNumeric("get"));f&&a.ajax({url:"/coupon-is-available/coupon/"+d+"/amount/"+g,type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(b){b||(c.prop("checked",!1),e.tips('<i class="fa fa-times-circle"></i>投资金额不少于'+c.attr("data-amount")+"才可使用此劵",".experience-ticket",{tips:[1,"#ff7200"],time:0}),a(".experience-revenue").hide(),minusCouponInterest())})})}q.length&&e.tips('<i class="fa fa-times-circle"></i>'+q.text(),".text-input-amount",{tips:[1,"#ff7200"],time:0})});