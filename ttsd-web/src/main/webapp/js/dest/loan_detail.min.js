<<<<<<< HEAD
require(["jquery","pagination","mustache","text!/tpl/loan-invest-list.mustache","layerWrapper","underscore","autoNumeric","coupon-alert","csrf"],function(a,b,c,d,e,f){function g(){if("/invest"===a("#investForm").attr("action")){if(!y)return location.href="/login?redirect="+encodeURIComponent(location.href),!1;var b=C();if(!E()){var c=0===b?"投资金额不能为0元！":"投资金额不能大于可投金额！";return e.tips('<i class="fa fa-times-circle"></i>'+c,".text-input-amount",{tips:[1,"#ff7200"],time:0}),!1}var d=parseInt(a("#investForm .account-amount").data("user-balance"))||0;if(b>d)return location.href="/recharge",!1}m.val(m.autoNumeric("get")),a("#investForm").submit()}function h(){e.open({type:1,closeBtn:0,shadeClose:!1,btn:["开启","不开启"],title:"免密投资",area:["500px","200px"],shadeClose:!0,content:'<p class="pad-m tc">您可直接开启免密投资，简化投资过程，理财快人一步，是否开启？</p>',yes:function(){1==t.val()?a.ajax({url:"/no-password-invset/enabled",type:"POST",dataType:"json"}).done(function(){e.closeAll(),e.msg("开通成功！")}).fail(function(){e.closeAll(),e.msg("开通失败，请重试！")}):a.ajax({url:"/no-password-invest/agreement",type:"POST",dataType:"json",data:{noPasswordInvset:!0}}).done(function(){window.open("/no-password-invest/agreement"),e.closeAll(),j()}).fail(function(){e.closeAll(),e.msg("开通失败，请重试！")})},cancle:function(){e.closeAll()}})}function i(){e.open({type:1,closeBtn:0,title:"免密投资",shadeClose:!1,btn:["开启免密投资","继续投资"],area:["500px","200px"],content:'<p class="pad-m tc">推荐您开通免密投资功能，简化投资过程，理财快人一步。</p>',yes:function(){},cancle:function(){g()}})}function j(){e.open({type:1,closeBtn:0,shadeClose:!1,title:"登录到联动优势支付平台开通免密投资",area:["500px","220px"],content:a("#isAuthorizeSuccess")})}var k=a(".loan-detail-content"),l=a(".hid-loan").val(),m=a(".text-input-amount",k),n=a(".account-info",k),o=a(".btn-pay",n),p=a(".loan-nav li"),q=a(".loan-list",k),r=a(".pagination",k),s=a(".errorTip"),t=a("#investNoPassword"),u=a("#loanInvest");e.ready(function(){e.photos({photos:"#picListBox"})});var v=k.data("loan-progress");50>=v?(a(".chart-box .rount").css("webkitTransform","rotate("+3.6*v+"deg)"),a(".chart-box .rount2").hide()):(a(".chart-box .rount").css("webkitTransform","rotate(180deg)"),a(".chart-box .rount2").show(),a(".chart-box .rount2").css("webkitTransform","rotate("+3.6*(v-50)+"deg)"));var w=function(){r.loadPagination({index:1},function(b){if(b.status){var e=c.render(d,b);a(".loan-list-con table").html(e)}})};if(q.find(".loan-list-con").eq(0).show(),p.click(function(){var b=a(this);b.addClass("active").siblings("li").removeClass("active");var c=b.index();1===c&&w(),q.find(".loan-list-con").eq(c).show().siblings(".loan-list-con").hide()}),"PREHEAT"===k.data("loan-status")){var x=k.data("loan-countdown");window.setInterval(function(){var b=0,c=0,d=0,e=0;1800>=x&&(x>0?(d=Math.floor(x/60)-24*b*60-60*c,e=Math.floor(x)-24*b*60*60-60*c*60-60*d):(o.prop("disabled",!1),o.html("马上投资"),n.find(".time-item").remove(),n.find(".invest-amount").show(),n.find(".experience-ticket").show(),n.find(".expected-interest-dd").show()),9>=d&&(d="0"+d),9>=e&&(e="0"+e),a("#minute_show").html(d+"分"),a("#second_show").html(e+"秒"),x--)},1e3)}if(m.length){m.autoNumeric("init"),m.focus(function(){e.closeAll("tips")});var y="INVESTOR"===k.data("user-role"),z=a(".ticket-list"),A=a("#use-experience-ticket"),B=a(".experience-income"),C=function(){var a=0;return isNaN(m.autoNumeric("get"))||(a=parseInt((100*m.autoNumeric("get")).toFixed(0))),a},D=function(){var b=C();a.each(z.find("li"),function(c,d){var e=a(d),f=a(e.find("input")),g=a(e.find(".ticket-term.lower-limit")).data("invest-lower-limit")||0,h=a(e.find(".ticket-term.upper-limit")).data("invest-upper-limit")||0,i=g>0&&g>b||h>0&&b>h;f.prop("disabled",i),i?e.addClass("disabled"):e.removeClass("disabled")});var c=f.groupBy(z.find("li[data-coupon-type='RED_ENVELOPE']"),function(b){return a(b).hasClass("disabled")?"disabled":"enabled"}),d=f.groupBy(z.find("li[data-coupon-type!='RED_ENVELOPE'][data-coupon-type!='BIRTHDAY_COUPON']"),function(b){return a(b).hasClass("disabled")?"disabled":"enabled"}),e=z.find("li[data-coupon-type='BIRTHDAY_COUPON']");z.empty(),e.length>0&&z.append(e),c.enabled&&z.append(f.sortBy(c.enabled,function(b){var c=a(b);return new Date(c.data("coupon-created-time")).getTime()})),d.enabled&&z.append(f.sortBy(d.enabled,function(b){var c=a(b);return new Date(c.data("coupon-created-time")).getTime()})),c.disabled&&z.append(f.sortBy(c.disabled,function(b){var c=a(b);return new Date(c.data("coupon-created-time")).getTime()})),d.disabled&&z.append(f.sortBy(d.disabled,function(b){var c=a(b);return new Date(c.data("coupon-created-time")).getTime()})),z.find("li").click(function(b){var c=a(b.currentTarget);if(c.hasClass("disabled"))return!1;var d=a.trim(c.find(".ticket-title").text());A.find("span").text(d),c.find("input").prop("checked",!0),B.text(""),F(),z.addClass("hide")})},E=function(){var b=C(),c=parseInt(a("form .amountNeedRaised-i").data("amount-need-raised"))||0;return b>0&&c>=b},F=function(){var b=[];return a.each(a('input[type="hidden"][name="userCouponIds"]'),function(c,d){b.push({name:"couponIds",value:a(d).data("coupon-id")})}),z.find("li").each(function(c,d){a(d).find('input[type="radio"]:checked').length>0&&b.push({name:"couponIds",value:a(d).data("coupon-id")})}),0==b.length?void B.text(""):void a.ajax({url:"/calculate-expected-coupon-interest/loan/"+l+"/amount/"+C(),data:a.param(b),type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){B.text("+"+a),o.prop("disabled",!1)})},G=function(){a.ajax({url:"/calculate-expected-interest/loan/"+l+"/amount/"+C(),type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(b){a(".principal-income").text(b)})};y&&(G(),F()),m.blur(function(){G(),F()}),m.keyup(function(b){if(y){var c=!0;z.find("li").each(function(b,d){"BIRTHDAY_COUPON"==a(d).attr("data-coupon-type")?(c=!1,a(d).find('input[type="radio"]').prop("checked",!0)):a(d).find('input[type="radio"]').prop("checked",!1)}),c?A.find("span").text("请选择优惠券"):A.find("span").text("生日福利")}}),u.on("click",function(a){a.preventDefault(),1==hasRemindInvestNoPassword?g():i()}),A.click(function(b){var c=a(this);return c.hasClass("disabled")?!1:(z.toggleClass("hide"),c.find(".fa-sort-down").toggleClass("hide").siblings(".fa-sort-up").toggleClass("hide"),z.hasClass("hide")||D(),void(b.stopPropagation?b.stopPropagation():window.event&&(window.event.cancelBubsuble=!0)))}),m.focus(function(a){z.addClass("hide")}),a("body").click(function(b){var c=b||window.event,d=c.srcElement||c.target;z.hasClass("hide")||0!=a(d).parents(".ticket-list").length||z.addClass("hide")})}s.length&&e.tips('<i class="fa fa-times-circle"></i>'+s.text(),".text-input-amount",{tips:[1,"#ff7200"],time:0}),a("#freeSecret").on("click",function(a){a.preventDefault(),h()})});
=======
require(["jquery","pagination","mustache","text!/tpl/loan-invest-list.mustache","layerWrapper","underscore","csrf","autoNumeric","coupon-alert"],function(a,b,c,d,e,f){var g=a(".loan-detail-content"),h=a(".hid-loan").val(),i=a(".text-input-amount",g),j=a(".account-info",g),k=a(".btn-pay",j),l=a(".loan-nav li"),m=a(".loan-list",g),n=a(".pagination",g),o=(a(".open-no-password-invest",g),a(".has-remind-invest-no-password",g)),p=a(".errorTip");e.ready(function(){e.photos({photos:"#picListBox"})});var q=g.data("loan-progress");50>=q?(a(".chart-box .rount").css("webkitTransform","rotate("+3.6*q+"deg)"),a(".chart-box .rount2").hide()):(a(".chart-box .rount").css("webkitTransform","rotate(180deg)"),a(".chart-box .rount2").show(),a(".chart-box .rount2").css("webkitTransform","rotate("+3.6*(q-50)+"deg)"));var r=function(){n.loadPagination({index:1},function(b){if(b.status){var e=c.render(d,b);a(".loan-list-con table").html(e)}})};if(m.find(".loan-list-con").eq(0).show(),l.click(function(){var b=a(this);b.addClass("active").siblings("li").removeClass("active");var c=b.index();1===c&&r(),m.find(".loan-list-con").eq(c).show().siblings(".loan-list-con").hide()}),"PREHEAT"===g.data("loan-status")){var s=g.data("loan-countdown");window.setInterval(function(){var b=0,c=0,d=0,e=0;1800>=s&&(s>0?(d=Math.floor(s/60)-24*b*60-60*c,e=Math.floor(s)-24*b*60*60-60*c*60-60*d):(k.prop("disabled",!1),k.html("马上投资"),j.find(".time-item").remove(),j.find(".invest-amount").show(),j.find(".experience-ticket").show(),j.find(".expected-interest-dd").show()),9>=d&&(d="0"+d),9>=e&&(e="0"+e),a("#minute_show").html(d+"分"),a("#second_show").html(e+"秒"),s--)},1e3)}if(i.length){i.autoNumeric("init"),i.focus(function(){e.closeAll("tips")});var t="INVESTOR"===g.data("user-role"),u=a(".ticket-list"),v=a("#use-experience-ticket"),w=a(".experience-income"),x=function(){var a=0;return isNaN(i.autoNumeric("get"))||(a=parseInt((100*i.autoNumeric("get")).toFixed(0))),a},y=function(){var b=x();a.each(u.find("li"),function(c,d){var e=a(d),f=a(e.find("input")),g=a(e.find(".ticket-term.lower-limit")).data("invest-lower-limit")||0,h=a(e.find(".ticket-term.upper-limit")).data("invest-upper-limit")||0,i=g>0&&g>b||h>0&&b>h;f.prop("disabled",i),i?e.addClass("disabled"):e.removeClass("disabled")});var c=f.groupBy(u.find("li[data-coupon-type='RED_ENVELOPE']"),function(b){return a(b).hasClass("disabled")?"disabled":"enabled"}),d=f.groupBy(u.find("li[data-coupon-type!='RED_ENVELOPE'][data-coupon-type!='BIRTHDAY_COUPON']"),function(b){return a(b).hasClass("disabled")?"disabled":"enabled"}),e=u.find("li[data-coupon-type='BIRTHDAY_COUPON']");u.empty(),e.length>0&&u.append(e),c.enabled&&u.append(f.sortBy(c.enabled,function(b){var c=a(b);return new Date(c.data("coupon-created-time")).getTime()})),d.enabled&&u.append(f.sortBy(d.enabled,function(b){var c=a(b);return new Date(c.data("coupon-created-time")).getTime()})),c.disabled&&u.append(f.sortBy(c.disabled,function(b){var c=a(b);return new Date(c.data("coupon-created-time")).getTime()})),d.disabled&&u.append(f.sortBy(d.disabled,function(b){var c=a(b);return new Date(c.data("coupon-created-time")).getTime()})),u.find("li").click(function(b){var c=a(b.currentTarget);if(c.hasClass("disabled"))return!1;var d=a.trim(c.find(".ticket-title").text());v.find("span").text(d),c.find("input").prop("checked",!0),w.text(""),A(),u.addClass("hide")})},z=function(){var b=x(),c=parseInt(a("form .amountNeedRaised-i").data("amount-need-raised"))||0;return b>0&&c>=b},A=function(){var b=[];return a.each(a('input[type="hidden"][name="userCouponIds"]'),function(c,d){b.push({name:"couponIds",value:a(d).data("coupon-id")})}),u.find("li").each(function(c,d){a(d).find('input[type="radio"]:checked').length>0&&b.push({name:"couponIds",value:a(d).data("coupon-id")})}),0==b.length?void w.text(""):void a.ajax({url:"/calculate-expected-coupon-interest/loan/"+h+"/amount/"+x(),data:a.param(b),type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){w.text("+"+a),k.prop("disabled",!1)})},B=function(){a.ajax({url:"/calculate-expected-interest/loan/"+h+"/amount/"+x(),type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(b){a(".principal-income").text(b)})};t&&(B(),A()),i.blur(function(){B(),A()}),i.keyup(function(b){if(t){var c=!0;u.find("li").each(function(b,d){"BIRTHDAY_COUPON"==a(d).attr("data-coupon-type")?(c=!1,a(d).find('input[type="radio"]').prop("checked",!0)):a(d).find('input[type="radio"]').prop("checked",!1)}),c?v.find("span").text("请选择优惠券"):v.find("span").text("生日福利")}}),a("form").submit(function(){o.val()||(a.ajax({url:"/no-password-invest/writeRemindFlag",type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}),a("#freeSecret").data("open-agreement")?e.open({type:1,title:"登录到联动优势支付平台充值",area:["500px","290px"],shadeClose:!0,content:a("#popInvestNoPassword")}):e.open({type:1,title:"登录到联动优势支付平台充值",area:["500px","290px"],shadeClose:!0,content:a("#popInvestNoPasswordAgree")}));var b=a(this);if("/invest"===b.attr("action")){if(!t)return location.href="/login?redirect="+encodeURIComponent(location.href),!1;var c=x();if(!z()){var d=0===c?"投资金额不能为0元！":"投资金额不能大于可投金额！";return e.tips('<i class="fa fa-times-circle"></i>'+d,".text-input-amount",{tips:[1,"#ff7200"],time:0}),!1}var f=parseInt(a("form .account-amount").data("user-balance"))||0;if(c>f)return location.href="/recharge",!1}return i.val(i.autoNumeric("get")),!0}),v.click(function(b){var c=a(this);return c.hasClass("disabled")?!1:(u.toggleClass("hide"),c.find(".fa-sort-down").toggleClass("hide").siblings(".fa-sort-up").toggleClass("hide"),u.hasClass("hide")||y(),void(b.stopPropagation?b.stopPropagation():window.event&&(window.event.cancelBubsuble=!0)))}),i.focus(function(a){u.addClass("hide")}),a("body").click(function(b){var c=b||window.event,d=c.srcElement||c.target;u.hasClass("hide")||0!=a(d).parents(".ticket-list").length||u.addClass("hide")})}p.length&&e.tips('<i class="fa fa-times-circle"></i>'+p.text(),".text-input-amount",{tips:[1,"#ff7200"],time:0}),a(".btn-open").click(function(){a.ajax({url:"/no-password-invest/enabled",type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){e.closeAll(),a.success&&e.alert("开启成功！",function(){e.closeAll()})}).fail(function(){e.alert("开启失败！")})})});
>>>>>>> features/zbx/invest_no_password_frontend
