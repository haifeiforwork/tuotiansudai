require(["jquery","commonFun","jquery.ajax.extension","autoNumeric","lodash","jquery.validate"],function(a,b){a(function(){if(a("#btnAuthority").length){var c=a("#btnAuthority");c.click(function(){var c='<div cass="auto-invest"><button id="finishAuthor" class="btn btn-normal">已完成授权</button></div>';b.popWindow("自动投标授权",c,{width:"450px"}),a("body").delegate("#finishAuthor","click",function(){location.href="/auto-invest/plan"})})}if(a("#planSwitchDom").length){var d=a("#planSwitchDom"),e=a(".switchBtn",d),f=a("label.radio",e),g=a(".projectLimit",d),h=a('input[type="radio"]',d),i=a("#saveInvestPlan"),j=a("#signPlanForm");b.initRadio(h,f),a("#plan-close").is(":checked")&&d.find("dl").first().show().siblings().hide(),a("input.autoNumeric").autoNumeric("init"),g.each(function(){var b=a(this),c=parseInt(b.data("value"));isNaN(c)||b.find("span").each(function(){var b=a(this),d=parseInt(b.data("value"));(d&c)==d&&b.addClass("active")})}),f.click(function(b){var c=a(this),e=c.prev("input").val();1==e?d.find("dl").show().siblings().show():a.ajax({url:"/auto-invest/turn-off",type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){d.find("dl").first().show().siblings().hide()}).fail(function(a){console.log(a)})});var k=function(){var b,c=[];return g.find("span.active").each(function(){var b=a(this);c.push(b.data("value"))}),b=_.sum(c)},l=function(){var b=k(),c=a("input.autoNumeric",j).serializeArray(),d=_.map(c,"value");b>0&&!_.isEmpty(d[0])&&!_.isEmpty(d[1])&&!_.isEmpty(d[2])?i.prop("disabled",!1).addClass("btn-normal"):i.prop("disabled",!0).removeClass("btn-normal")};g.find("span").click(function(){var b=a(this);b.toggleClass("active"),l()}),a("#checkOption").click(function(){l()}),a("input",j).bind("keyup",function(){l()}),l(),i.click(function(){var b={minInvestAmount:a('input[name="minInvestAmount"]').autoNumeric("get"),maxInvestAmount:a('input[name="maxInvestAmount"]').autoNumeric("get"),retentionAmount:a('input[name="retentionAmount"]').autoNumeric("get"),autoInvestPeriods:k()};return parseInt(b.maxInvestAmount)<parseInt(b.minInvestAmount)?(alert("投资金额范围输入有误"),!1):void a.ajax({url:"/auto-invest/turn-on",data:JSON.stringify(b),type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){a.data.status&&(location.href="plan-detail")}).fail(function(a){console.log(a)})})}a("#editSetting").length&&a("#editSetting").click(function(){var a=location.href.replace(/plan-detail/,"plan");location.href=a})})});