require(["jquery","csrf","autoNumeric","lodash","commonFun","jquery.validate"],function(a){a(function(){if(a("#btnAuthority").length){var b=a("#btnAuthority");b.click(function(){var b='<div cass="auto-invest"><button id="finishAuthor" class="btn btn-normal">已完成授权</button></div>';commonFun.popWindow("自动投标授权",b,{width:"450px"}),a("body").delegate("#finishAuthor","click",function(){location.href="/investor/auto-invest/plan"})})}if(a("#planSwitchDom").length){var c=a("#planSwitchDom"),d=a(".switchBtn",c),e=a("label.radio",d),f=a(".projectLimit",c),g=a('input[type="radio"]',c),h=a("#saveInvestPlan"),i=a("#signPlanForm");commonFun.initRadio(g,e),a("#plan-close").is(":checked")&&c.find("dl").first().show().siblings().hide(),a("input.autoNumeric").autoNumeric("init"),f.each(function(){var b=a(this),c=parseInt(b.data("value"));isNaN(c)||b.find("span").each(function(){var b=a(this),d=parseInt(b.data("value"));(d&c)==d&&b.addClass("active")})}),e.click(function(b){var d=a(this),e=d.prev("input").val();1==e?c.find("dl").show().siblings().show():a.ajax({url:"/investor/auto-invest/turn-off",type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){c.find("dl").first().show().siblings().hide()}).fail(function(a){console.log(a)})});var j=function(){var b,c=[];return f.find("span.active").each(function(){var b=a(this);c.push(b.data("value"))}),b=_.sum(c)},k=function(){var b=j(),c=a("input.autoNumeric",i).serializeArray(),d=_.map(c,"value");b>0&&!_.isEmpty(d[0])&&!_.isEmpty(d[1])&&!_.isEmpty(d[2])?h.prop("disabled",!1):h.prop("disabled",!0)};f.find("span").click(function(){var b=a(this);b.toggleClass("active"),k()}),a("#checkOption").click(function(){k()}),a("input",i).bind("keyup",function(){k()}),k(),h.click(function(){var b={minInvestAmount:a('input[name="minInvestAmount"]').autoNumeric("get"),maxInvestAmount:a('input[name="maxInvestAmount"]').autoNumeric("get"),retentionAmount:a('input[name="retentionAmount"]').autoNumeric("get"),autoInvestPeriods:j()};return parseInt(b.maxInvestAmount)<parseInt(b.minInvestAmount)?(alert("投资金额范围输入有误"),!1):void a.ajax({url:"/investor/auto-invest/turn-on",data:JSON.stringify(b),type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){a.data.status&&(location.href="plan-detail")}).fail(function(a){console.log(a)})})}a("#editSetting").length&&a("#editSetting").click(function(){var a=location.href.replace(/plan-detail/,"plan");location.href=a})})});