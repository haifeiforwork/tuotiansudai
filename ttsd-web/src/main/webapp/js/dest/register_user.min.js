require(["underscore","jquery","layer","jquery.validate","jquery.validate.extension","jquery.form","csrf"],function(a,b,c){var d=b(".register-user-form"),e=b(".fetch-captcha",d),f=b(".image-captcha-dialog"),g=b(".image-captcha-form",f),h=b(".image-captcha",f),i=b(".image-captcha-text",f),j=b(".image-captcha-confirm",f);e.on("click",function(){c.open({type:1,title:"手机验证",area:["360px","225px"],shadeClose:!0,content:b(".image-captcha-dialog"),success:function(a,c){b(".image-captcha-form label").remove(),i.val(""),k()}})});var k=function(){h.attr("src","/register/user/image-captcha?"+(new Date).getTime().toString())};h.click(function(){k()}),g.validate({success:"form-valid",focusInvalid:!1,errorClass:"form-error",onkeyup:!0,onfocusout:function(a){this.checkable(a)||this.optional(a)||this.element(a)},submitHandler:function(a){var c=this;b(a).ajaxSubmit({data:{mobile:b(".mobile").val()},dataType:"json",beforeSubmit:function(a,b,c){j.addClass("loading"),j.attr("disabled",!0)},success:function(a){var b=a.data;if(!b.status||b.isRestricted)!b.status&&b.isRestricted&&c.showErrors({imageCaptcha:"短信发送频繁，请稍后再试"}),b.status||b.isRestricted||c.showErrors({imageCaptcha:"图形验证码不正确"}),c.invalid.imageCaptcha=!0,k();else var d=60,f=setInterval(function(){e.html(d+"秒后重新发送").css({background:"#666","pointer-events":"none"}),0==d&&(clearInterval(f),e.html("重新发送").css({background:"#f68e3a","pointer-events":"auto"})),d--},1e3)},error:function(){c.invalid.imageCaptcha=!0,c.showErrors({imageCaptcha:"图形验证码不正确"}),k()},complete:function(){j.removeClass("loading"),j.prop("disabled",!1)}})},rules:{imageCaptcha:{required:!0,regex:"^[a-zA-Z0-9]{5}$",imageCaptchaVerify:"/register/user/image-captcha/{0}/verify"}},messages:{imageCaptcha:{required:"请输入图形验证码",regex:"图形验证码不正确",imageCaptchaVerify:"图形验证码不正确"}}}),d.validate({success:"form-valid",focusInvalid:!1,errorClass:"form-error",onkeyup:!0,rules:{loginName:{required:!0,checkUser:!0,isExist:"/register/user/login-name/{0}/is-exist"},mobile:{required:!0,checkMobile:!0,isExist:"/register/user/mobile/{0}/is-exist"},password:{required:!0,checkPass:!0},captcha:{required:!0,digits:!0,rangelength:[6,6],captchaVerify:{param:function(){var a=b(".register .mobile").val();return"/register/user/mobile/"+a+"/captcha/{0}/verify"}}},referrer:{isNotExist:"/register/user/login-name/{0}/is-exist"},agreement:{required:!0}},messages:{loginName:{required:"请输入用户名",isExist:"用户名已存在"},mobile:{required:"请输入手机号",isExist:"手机号已存在"},password:{required:"请输入密码"},captcha:{required:"请输入验证码",digits:"验证码格式不正确",rangelength:"验证码格式不正确",captchaVerify:"验证码不正确"},referrer:{isNotExist:"推荐人不存在"},agreement:{required:"请同意服务协议"}},onkeyup:function(a,c){var d=[16,17,18,20,35,36,37,38,39,40,45,144,225];9===c.which&&""===this.elementValue(a)||-1!==b.inArray(c.keyCode,d)||this.element(a)},onfocusout:function(a){this.checkable(a)||this.optional(a)||this.element(a)},showErrors:function(a,c){this.__proto__.defaultShowErrors.call(this),a.mobile&&b(".fetch-captcha").prop("disabled",!0)},success:function(a,c){a.addClass("valid"),"mobile"===c.name&&b(".fetch-captcha").prop("disabled",!1)}}),jQuery.validator.addMethod("checkUser",function(a,b){var c=/(?!^\d+$)^\w{6,20}$/;return this.optional(b)||c.test(a)},"6位至20位数字与字母下划线组合，不能全部数字"),jQuery.validator.addMethod("checkMobile",function(a,b){var c=/^1[3|4|5|7|8]\d{9}$/;return this.optional(b)||c.test(a)},"手机格式不对"),jQuery.validator.addMethod("checkPass",function(a,b){var c=/^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+){6,20}$/;return this.optional(b)||c.test(a)},"6位至20位数字与字母组合")});