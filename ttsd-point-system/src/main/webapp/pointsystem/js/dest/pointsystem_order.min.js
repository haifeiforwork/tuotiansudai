require(["jquery","layerWrapper","jquery.validate","jquery.ajax.extension"],function(a,b){a(function(){function c(){a(".count-num").each(function(b,c){a(this).text(parseInt(a(this).attr("data-num"))*parseInt(f.val()))})}function d(c){var d={};"add"==c?d={url:"/pointsystem/add-address",data:{realName:a("#Recipient").val(),mobile:a("#Phone").val(),address:a("#AddRess").val()}}:"update"==c&&(d={url:"/pointsystem/update-address",data:{id:a("#updatePlace").attr("data-id"),realName:a("#Recipient").val(),mobile:a("#Phone").val(),address:a("#AddRess").val()}}),a.ajax({url:d.url,type:"POST",dataType:"json",data:d.data}).done(function(a){location.reload()}).fail(function(){b.msg("请求失败，请重试！")})}var e=a(".order-number"),f=e.find(".num-text"),g=e.find(".total-num i"),h=a("#orderBtn"),i=a("#addPlace"),j=a("#updatePlace"),k=a("#addressForm");e.on("click",".low-btn",function(a){a.preventDefault(),g.text()>0&&(f.val()>1?f.val(function(a,b){return parseInt(b)-1})&&c():f.val("1"))}).on("click",".add-btn",function(a){a.preventDefault(),g.text()>0&&(f.val()<parseInt(g.text())?f.val(function(a,b){return parseInt(b)+1})&&c():f.val(g.text()))}),c(),h.on("click",function(c){c.preventDefault();var d=a(this),e=d.attr("data-id"),g=d.attr("data-type");a.ajax({url:"/pointsystem/order",type:"POST",dataType:"json",data:{id:e,itemType:g,number:f.val()}}).done(function(c){console.log(c),c.data.status?location.href="/pointsystem/bill":(b.msg(c.data.message),b.open({type:1,title:!1,area:["300px","auto"],content:a("#errorTip")}))}).fail(function(a){b.msg("请求失败，请重试！")})}),i.on("click",function(c){c.preventDefault(),k.attr("data-type","add"),b.open({type:1,title:"添加地址",area:["700px","auto"],content:a("#fixAdress")})}),j.on("click",function(c){c.preventDefault();var d=a(this),e=d.attr("data-user"),f=d.attr("data-phone"),g=d.attr("data-address");a("#Recipient").val(e),a("#Phone").val(f),a("#AddRess").val(g),k.attr("data-type","update"),b.open({type:1,title:"添加地址",area:["700px","auto"],content:a("#fixAdress")})}),jQuery.validator.addMethod("isPhone",function(a,b){var c=/0?(13|14|15|18)[0-9]{9}/;return this.optional(b)||c.test(a)},"请正确填写您的手机号码"),k.validate({debug:!0,focusInvalid:!1,rules:{Recipient:{required:!0},Phone:{required:!0,isPhone:!0,minlength:11,maxlength:11},AddRess:{required:!0,maxlength:100}},messages:{Recipient:{required:"请填写收件人"},Phone:{required:"请输入手机号",isPhone:"请输入正确的手机号码",minlength:"手机格式不正确",maxlength:"手机格式不正确"},AddRess:{required:"请填写收件地址",maxlength:"收件地址字数限制在100字以内"}},errorPlacement:function(a,b){a.appendTo(b.parent())},submitHandler:function(b){d(a(b).attr("data-type"))}})})});