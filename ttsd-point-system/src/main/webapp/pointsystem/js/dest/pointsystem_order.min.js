require(["jquery", "layerWrapper", "jquery.ajax.extension"], function (a, b) {
    a(function () {
        function c() {
            a(".count-num").each(function (b, c) {
                a(this).text(parseInt(a(this).attr("data-num")) * parseInt(e.val()))
            })
        }

        var d = a(".order-number"), e = d.find(".num-text"), f = d.find(".total-num i"), g = a("#orderBtn");
        d.on("click", ".low-btn", function (a) {
            a.preventDefault(), f.text() > 0 && (e.val() > 1 ? e.val(function (a, b) {
                return parseInt(b) - 1
            }) && c() : e.val("1"))
        }).on("click", ".add-btn", function (a) {
            a.preventDefault(), f.text() > 0 && (e.val() < parseInt(f.text()) ? e.val(function (a, b) {
                return parseInt(b) + 1
            }) && c() : e.val(f.text()))
        }), c(), g.on("click", function (c) {
            c.preventDefault();
            var d = a(this), f = d.attr("data-id"), g = d.attr("data-type");
            a.ajax({
                url: "/pointsystem/order",
                type: "POST",
                dataType: "json",
                data: {id: f, itemType: g, number: e.val()}
            }).done(function (a) {
                console.log(a), a.data.status ? location.href = "/pointsystem/bill" : b.msg(a.data.message)
            }).fail(function (a) {
                b.msg("请求失败，请重试！")
            })
        })
    })
});