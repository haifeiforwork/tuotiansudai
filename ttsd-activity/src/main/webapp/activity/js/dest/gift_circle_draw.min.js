define(["jquery","rotate","layerWrapper"],function(a,b,c){function d(b,d,e,f,g){this.bRotate=!1,this.allListURL=b,this.userListURL=d,this.drawURL=e,this.paramData=f,this.giftCircleFrame=g,this.beginLotteryDraw=function(b){this.bRotate||a.ajax({url:this.drawURL,data:this.paramData,type:"POST",dataType:"json"}).done(function(a){b(a)}).fail(function(){c.msg("请求失败")})},this.GiftRecord=function(){a.ajax({url:this.allListURL,data:this.paramData,type:"GET",dataType:"json"}).done(function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push("<li>恭喜"+a[c].mobile+"抽中了"+a[c].prizeValue+"</li>");this.giftCircleFrame.find(".user-record").empty().append(b.join("")),this.hoverScrollList(this.giftCircleFrame.find(".user-record"))}.bind(this))},this.MyGift=function(){a.ajax({url:this.userListURL,data:this.paramData,type:"GET",dataType:"json"}).done(function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push("<li>"+a[c].prizeValue+"<time>"+a[c].lotteryTime+"</time></li>");this.giftCircleFrame.find(".own-record").empty().append(b.join("")),this.hoverScrollList(this.giftCircleFrame.find(".own-record"))}.bind(this))}}return d.prototype.rotateFn=function(a,b){var c=this;c.bRotate=!this.bRotate,c.giftCircleFrame.find(".rotate-btn").stopRotate(),c.giftCircleFrame.find(".rotate-btn").rotate({angle:0,animateTo:a+1800,duration:8e3,callback:function(){c.GiftRecord(),c.MyGift(),c.bRotate=!c.bRotate,c.tipWindowPop(b)}})},d.prototype.beginLuckDraw=function(a){var b=this;b.giftCircleFrame.find(".pointer-img").on("click",function(c){b.beginLotteryDraw(function(b){a&&a(b)})})},d.prototype.scrollList=function(a){var b=a,c=b.find("li:first").height();b.find("li").length>10&&b.animate({"margin-top":-c+"px"},600,function(){b.css({"margin-top":"0px"}).find("li:first").appendTo(b)})},d.prototype.hoverScrollList=function(a){var b,c=this;a.hover(function(){clearInterval(b)},function(){b=setInterval(function(){c.scrollList(a)},2e3)}).trigger("mouseout")},d.prototype.tipWindowPop=function(b){0==b.area.length&&(b.area=["460px","370px"]);var d={};a(".layui-layer-shade").length&&(d={shade:0});var e=a.extend({},{type:1,title:!1,area:b.area,shade:.8,closeBtn:0,shadeClose:!0,skin:"layer-gift-draw",content:'<div class="tip-list"><div class="close-btn go-close"></div><div class="text-tip">'+b.info+'</div><div class="btn-list">'+b.button+"</div></div>"},d);c.open(e)},d.prototype.PrizeSwitch=function(){var b=this.giftCircleFrame.find(".gift-record").find("li"),c=this.giftCircleFrame.find(".record-list ul");b.on("click",function(b){var d=a(this),b=d.index();d.addClass("active").siblings().removeClass("active"),c.eq(b).show().siblings().hide()})},a("body").on("click",".go-close",function(b){b.preventDefault();a(this);c.closeAll()}),d});