define(["jquery","rotate","layerWrapper","template"],function(a,b,c,d){function e(b,e,f,g){this.bRotate=!1,this.allListURL=b,this.userListURL=e,this.drawURL=f,this.mobileNumber=g,this.beginLotteryDraw=function(b){this.bRotate||a.ajax({url:this.drawURL+"?mobile="+this.mobileNumber,type:"POST",dataType:"json"}).done(function(a){b(a)}).fail(function(){c.msg("请求失败")})},this.GiftRecord=function(){a.ajax({url:this.allListURL,type:"GET",dataType:"json"}).done(function(b){a("#GiftRecord").html(d("GiftRecordTpl",{record:b}))})},this.MyGift=function(){a.ajax({url:this.userListURL+"?mobile="+g,type:"GET",dataType:"json"}).done(function(b){a("#MyGift").html(d("MyGiftTpl",{gift:b}))})}}function f(a){var b=a.find("ul.user-record"),c=b.find("li:first").height();b.find("li").length>10&&b.animate({"margin-top":-c+"px"},600,function(){b.css({"margin-top":"0px"}).find("li:first").appendTo(b)})}var g=a(".gift-record li");e.prototype.rotateFn=function(b,c,e){this.bRotate=!this.bRotate,a("#rotate").stopRotate(),a("#rotate").rotate({angle:0,animateTo:b+1800,duration:8e3,callback:function(){a("#tipList").html(d("tipListTpl",{tiptext:"抽中了"+c,istype:e})).show().find(".tip-dom").show(),this.bRotate=!this.bRotate,this.GiftRecord(),this.MyGift(),a(".lottery-time").each(function(b,c){a(this).text()>1?a(this).text(function(a,b){return parseInt(b)-1}):a(this).text("0")})}})},g.on("click",function(b){var c=a(this),d=c.index();c.addClass("active").siblings("li").removeClass("active"),a("#recordList").find(".record-model:eq("+d+")").addClass("active").siblings(".record-model").removeClass("active")}),a("body").on("click",".go-close",function(b){b.preventDefault();var c=a(this),d=c.parents(".tip-list"),e=d.find(".tip-dom");d.hide(),e.hide()});var h;return a(".user-record").hover(function(){clearInterval(h)},function(){h=setInterval(function(){f(a("#recordList"))},2e3)}).trigger("mouseout"),e});