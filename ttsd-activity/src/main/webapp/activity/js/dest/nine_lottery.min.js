define(["jquery","layerWrapper","template","commonFun"],function(a,b,c){function d(){if(i.times+=1,i.roll(),i.times>i.cycle+10&&i.prize==i.index)clearTimeout(i.timer),i.prize=-1,i.times=0,i.click=!1,b.open({type:1,title:!1,closeBtn:0,content:a("#lotteryTip")}),f();else{if(i.times<i.cycle)i.speed-=10;else if(i.times==i.cycle){var c=Math.random()*i.count|0;i.prize=c}else i.times>i.cycle+10&&(0==i.prize&&7==i.index||i.prize==i.index+1)?i.speed+=110:i.speed+=20;i.speed<40&&(i.speed=40),i.timer=setTimeout(d,i.speed)}return!1}function e(a){var b=a.find("ul:first"),c=b.find("li:first").height();b.find("li").length>10&&b.animate({"margin-top":-c+"px"},600,function(){b.css({"margin-top":"0px"}).find("li:first").appendTo(b)})}function f(){a.ajax({url:"/activity/point-draw/all-list",type:"POST",dataType:"json",data:{param1:"value1"}}).done(function(b){var d={list:b};a("#recordList").html(c("recordListTpl",d.list))}).fail(function(){b.msg("请求失败，请刷新页面重试")}),a.ajax({url:"/activity/point-draw/user-list",type:"POST",dataType:"json",data:{param1:"value1"}}).done(function(b){var d={list:b};a("#myRecord").html(c("myRecordTpl",d.list))}).fail(function(){b.msg("请求失败，请刷新页面重试")})}var g,h=a("#lotteryList"),i={click:!1,index:-1,count:0,timer:0,speed:20,times:0,cycle:50,prize:-1,init:function(b){a("#"+b).find(".lottery-unit").length>0&&($lottery=a("#"+b),$units=$lottery.find(".lottery-unit"),this.obj=$lottery,this.count=$units.length,$lottery.find(".lottery-unit-"+this.index).addClass("active"))},roll:function(){var b=this.index,c=this.count,d=this.obj;return a(d).find(".lottery-unit-"+b).removeClass("active"),b+=1,b>c-1&&(b=0),a(d).find(".lottery-unit-"+b).addClass("active"),this.index=b,!1},stop:function(a){return this.prize=a,!1}};i.init("lottery"),a("#lottery .lottery-btn").on("click",function(e){e.preventDefault(),a.ajax({url:"/activity/isLogin",type:"GET",dataType:"json",contentType:"application/json; charset=UTF-8"}).fail(function(e){if(""!=e.responseText){a("meta[name='_csrf']").remove(),a("head").append(a(e.responseText));var f=a("meta[name='_csrf']").attr("content"),g=a("meta[name='_csrf_header']").attr("content");a(document).ajaxSend(function(a,b,c){b.setRequestHeader(g,f)}),b.open({type:1,title:!1,closeBtn:0,area:["auto","auto"],content:a("#loginTip")})}else{if(i.click)return!1;a.ajax({url:"/path/to/file",type:"POST",dataType:"json"}).done(function(b){var d={list:b};a("#lotteryTip").html(c("lotteryTipTpl",d.list))}).fail(function(){b.msg("抽奖失败，请重试")}),i.speed=100,d(),i.click=!0}})}),a("h3 span",h).on("click",function(b){b.preventDefault();var c=a(this),d=c.index();c.closest(".lottery-right-group").find(".record-group");c.addClass("active").siblings().removeClass("active").closest(".lottery-right-group").find(".record-group .record-item:eq("+d+")").addClass("active").siblings().removeClass("active")}),a("#lotteryTip").on("click",".close-item",function(a){a.preventDefault(),b.closeAll()}),a(".record-group",h).hover(function(){clearInterval(g)},function(){g=setInterval(function(){e(a(".record-group"),h)},2e3)}).trigger("mouseout"),f()});