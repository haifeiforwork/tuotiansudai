require(["jquery","layerWrapper","underscore","jquery.validate","jquery.validate.extension","jquery.ajax.extension"],function(a,b,c){a(function(){var c=a("#androidForm"),d=a("#iosForm"),e=a("#androidBtn"),f=a("#iosBtn"),g=60,h={androidCount:function(){timer=setInterval(function(){e.prop("disabled",!0).val(g+"s"),g--,0==g&&(clearInterval(timer),g=60,e.prop("disabled",!1).val("重新发送"))},1e3)},anCaptcha:function(c){0==c?a.ajax({url:"/register/user/send-register-captcha",type:"POST",dataType:"json",data:{mobile:a("#mobile").val()}}).done(function(a){a.data.status&&!a.data.isRestricted?h.androidCount():!a.data.status&&a.data.isRestricted&&b.msg("短信发送频繁,请稍后再试")}).fail(function(){b.msg("请求失败，请重试！")}):location.href="/share-app"},iosCount:function(){timer=setInterval(function(){f.prop("disabled",!0).val(g+"s"),g--,0==g&&(clearInterval(timer),g=60,f.prop("disabled",!1).val("重新发送"))},1e3)},iosCaptcha:function(c){0==c?a.ajax({url:"/register/user/send-register-captcha",type:"POST",dataType:"json",data:{mobile:a("#mobile").val()}}).done(function(a){a.data.status&&!a.data.isRestricted?h.iosCount():!a.data.status&&a.data.isRestricted&&b.msg("短信发送频繁,请稍后再试")}).fail(function(){b.msg("请求失败，请重试！")}):location.href="/share-app"},showTip:function(){b.open({type:1,title:!1,closeBtn:0,btn:0,area:["240px","auto"],shadeClose:!0,content:'<div class="tip-item tc"><p>哇，真的拿到了5888体验金，快去体验那更多奖励吧！</p><a href="/app/download">下载APP开始赚钱</a></div>'})}};jQuery.validator.addMethod("isPhone",function(a,b){var c=/0?(13|14|15|18)[0-9]{9}/;return this.optional(b)||c.test(a)},"请正确填写您的手机号码"),c.validate({debug:!0,focusInvalid:!1,ignore:".ignore",rules:{mobile:{required:!0,digits:!0,isPhone:!0,minlength:11,maxlength:11,isExist:"/register/user/mobile/{0}/is-exist"},password:{required:!0,regex:/^(?=.*[^\d])(.{6,20})$/},captcha:{required:!0,digits:!0,maxlength:6,minlength:6,captchaVerify:{param:function(){var b=a("#mobile").val();return"/register/user/mobile/"+b+"/captcha/{0}/verify"}}},agree:{required:!0}},messages:{mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",isPhone:"请输入正确的手机号码",maxlength:"手机格式不正确",isExist:"手机号已存在"},password:{required:"请输入密码",regex:"6位至20位，不能全是数字"},captcha:{required:"请输入手机验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",minlength:"验证码格式不正确",captchaVerify:"验证码不正确"},agree:"请同意服务协议"},errorPlacement:function(a,b){a.appendTo(b.parent())},submitHandler:function(c){a.ajax({url:"/register/user/shared",type:"POST",dataType:"json",data:{mobile:a("#mobile").val(),password:a("#password").val(),captcha:a("#captchaText").val(),referrer:a("#referrer").attr("data-referrer"),source:"MOBILE"}}).done(function(a){1==a.status?h.showTip():b.msg("请求失败，请重试！")}).fail(function(){b.msg("请求失败，请重试！")})}}),d.validate({debug:!0,focusInvalid:!1,ignore:".ignore",rules:{mobile:{required:!0,digits:!0,isPhone:!0,minlength:11,maxlength:11,isExist:"/register/user/mobile/{0}/is-exist"},captcha:{required:!0,digits:!0,maxlength:6,minlength:6,captchaVerify:{param:function(){var b=a("#mobile").val();return"/register/user/mobile/"+b+"/captcha/{0}/verify"}}},agree:{required:!0}},messages:{mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",isPhone:"请输入正确的手机号码",maxlength:"手机格式不正确",isExist:"手机号已存在"},captcha:{required:"请输入手机验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",minlength:"验证码格式不正确",captchaVerify:"验证码不正确"},agree:"请同意服务协议"},errorPlacement:function(a,b){a.appendTo(b.parent())},submitHandler:function(c){a.ajax({url:"/register/user/shared-prepare",type:"POST",dataType:"json",data:{mobile:a("#mobile").val(),captcha:a("#captchaText").val(),referrerMobile:a("#referrer").attr("data-referrer"),channel:"IOS"}}).done(function(a){1==a.status?h.showTip():b.msg("请求失败，请重试！")}).fail(function(){b.msg("请求失败，请重试！")})}}),e.on("click",function(c){c.preventDefault(),a.ajax({url:"/register/user/mobile/"+a("#mobile").val()+"/is-exist",type:"POST",dataType:"json",data:{mobile:a("#mobile").val()}}).done(function(a){h.anCaptcha(a.status)}).fail(function(a){b.msg("请求失败，请重试")})}),f.on("click",function(c){c.preventDefault(),a.ajax({url:"/register/user/mobile/"+a("#mobile").val()+"/is-exist",type:"POST",dataType:"json",data:{mobile:a("#mobile").val()}}).done(function(a){h.iosCaptcha(a.status)}).fail(function(a){b.msg("请求失败，请重试")})})})});