require(["jquery","layerWrapper","underscore","jquery.validate","jquery.validate.extension","jquery.ajax.extension"],function(a,b,c){a(function(){var c=a("#androidForm"),d=a("#iosForm"),e=a("#androidBtn"),f=a("#iosBtn"),g=60,h={androidCount:function(){timer=setInterval(function(){e.prop("disabled",!0).val(g+"s"),g--,0==g&&(clearInterval(timer),g=60,e.prop("disabled",!1).val("重新发送"))},1e3)},anCaptcha:function(c){if(0==c)a.ajax({url:"/register/user/"+a("#mobile").val()+"/send-register-captcha",type:"get",dataType:"json"}).done(function(a){a.data.status&&!a.data.isRestricted?h.androidCount():!a.data.status&&a.data.isRestricted&&b.msg("短信发送频繁,请稍后再试")}).fail(function(){b.msg("请求失败，请重试！")});else{var d=JSON.parse('{"'+decodeURI(location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');location.href="/activity/app-share?referrerMobile="+d.referrerMobile}},iosCount:function(){timer=setInterval(function(){f.prop("disabled",!0).val(g+"s"),g--,0==g&&(clearInterval(timer),g=60,f.prop("disabled",!1).val("重新发送"))},1e3)},iosCaptcha:function(c){if(0==c)a.ajax({url:"/register/user/"+a("#mobile").val()+"/send-register-captcha",type:"get",dataType:"json"}).done(function(a){a.data.status&&!a.data.isRestricted?h.iosCount():!a.data.status&&a.data.isRestricted&&b.msg("短信发送频繁,请稍后再试")}).fail(function(){b.msg("请求失败，请重试！")});else{var d=JSON.parse('{"'+decodeURI(location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');location.href="/activity/app-share?referrerMobile="+d.referrerMobile}}};jQuery.validator.addMethod("isPhone",function(a,b){var c=/0?(13|14|15|18|17)[0-9]{9}/;return this.optional(b)||c.test(a)},"请正确填写您的手机号码"),c.validate({debug:!0,focusInvalid:!1,ignore:".ignore",rules:{mobile:{required:!0,digits:!0,isPhone:!0,minlength:11,maxlength:11,isExist:"/register/user/mobile/{0}/is-exist"},password:{required:!0,regex:/^(?=.*[^\d])(.{6,20})$/},captcha:{required:!0,digits:!0,maxlength:6,minlength:6,captchaVerify:{param:function(){var b=a("#mobile").val();return"/register/user/mobile/"+b+"/captcha/{0}/verify"}}},agree:{required:!0}},messages:{mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",isPhone:"请输入正确的手机号码",maxlength:"手机格式不正确",isExist:"手机号已存在"},password:{required:"请输入密码",regex:"6位至20位，不能全是数字"},captcha:{required:"请输入手机验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",minlength:"验证码格式不正确",captchaVerify:"验证码不正确"},agree:"请同意服务协议"},errorPlacement:function(a,b){a.appendTo(b.parent())},submitHandler:function(c){a.ajax({url:"/register/user/shared",type:"POST",dataType:"json",data:{mobile:a("#mobile").val(),password:a("#password").val(),captcha:a("#captcha").val(),referrer:JSON.parse('{"'+decodeURI(location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}').referrerMobile,agreement:"checked"==a("#agreement").attr("checked")}}).done(function(a){1==a.data.status?location.href="/activity/app-share?referrerMobile="+location.href.split("referrerMobile=")[1]:b.msg("请求失败，请重试！")}).fail(function(){b.msg("请求失败，请重试！")})}}),d.validate({debug:!0,focusInvalid:!1,ignore:".ignore",rules:{mobile:{required:!0,digits:!0,isPhone:!0,minlength:11,maxlength:11,isExist:"/register/user/mobile/{0}/is-exist"},captcha:{required:!0,digits:!0,maxlength:6,minlength:6,captchaVerify:{param:function(){var b=a("#mobile").val();return"/register/user/mobile/"+b+"/captcha/{0}/verify"}}},agree:{required:!0}},messages:{mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",isPhone:"请输入正确的手机号码",maxlength:"手机格式不正确",isExist:"手机号已存在"},captcha:{required:"请输入手机验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",minlength:"验证码格式不正确",captchaVerify:"验证码不正确"},agree:"请同意服务协议"},errorPlacement:function(a,b){a.appendTo(b.parent())},submitHandler:function(c){a.ajax({url:"/register/user/shared-prepare",type:"POST",dataType:"json",data:{mobile:a("#mobile").val(),captcha:a("#captcha").val(),referrerMobile:JSON.parse('{"'+decodeURI(location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}').referrerMobile}}).done(function(a){1==a.data.status?location.href="/activity/app-share?referrerMobile="+location.href.split("referrerMobile=")[1]:b.msg("请求失败，请重试！")}).fail(function(){b.msg("请求失败，请重试！")})}}),e.on("click",function(c){c.preventDefault(),a.ajax({url:"/register/user/mobile/"+a("#mobile").val()+"/is-register",type:"get",dataType:"json"}).done(function(a){h.anCaptcha(a.data.status)}).fail(function(a){b.msg("请求失败，请重试")})}),f.on("click",function(c){c.preventDefault(),a.ajax({url:"/register/user/mobile/"+a("#mobile").val()+"/is-register",type:"get",dataType:"json"}).done(function(a){h.iosCaptcha(a.data.status)}).fail(function(a){b.msg("请求失败，请重试")})})})});