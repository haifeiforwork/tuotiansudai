define(["jquery","rotate","layerWrapper","template","jquery.validate","jquery.validate.extension","jquery.ajax.extension"],function(a,b,c,d){function e(b,c,e,f){i=!i,a("#rotate").stopRotate(),a("#rotate").rotate({angle:0,animateTo:c+1800,duration:8e3,callback:function(){a("#tipList").html(d("tipListTpl",{tiptext:"抽中了"+e,istype:f})).show().find(".tip-dom").show(),i=!i,a(".lottery-time").each(function(b,c){a(this).text()>1?a(this).text(function(a,b){return parseInt(b)-1}):a(this).text("0")}),g(),h()}})}function f(a){var b=a.find("ul.user-record"),c=b.find("li:first").height();b.find("li").length>10&&b.animate({"margin-top":-c+"px"},600,function(){b.css({"margin-top":"0px"}).find("li:first").appendTo(b)})}function g(){var b="/activity/autumn/luxury-all-list";"travel"==a("#themeType").val()&&(b="/activity/autumn/travel-all-list"),a.ajax({url:b,type:"GET",dataType:"json"}).done(function(b){a("#GiftRecord").html(d("GiftRecordTpl",{record:b}))})}function h(){var b=a("div.mobile"),c=b?b.data("mobile"):"",e="/activity/autumn/luxury-user-list?mobile="+c;"travel"==a("#themeType").val()&&(e="/activity/autumn/travel-user-list?mobile="+c),a.ajax({url:e,type:"GET",dataType:"json"}).done(function(b){a("#MyGift").html(d("MyGiftTpl",{gift:b}))})}var i=!1,j=a("#pointer"),k=(a("#rotate"),a(".gift-record li"));k.on("click",function(b){var c=a(this),d=c.index();c.addClass("active").siblings("li").removeClass("active"),a("#recordList").find(".record-model:eq("+d+")").addClass("active").siblings(".record-model").removeClass("active")}),j.on("click",function(b){b.preventDefault();var f=a("div.mobile"),g=f?f.data("mobile"):"",h="/activity/autumn/luxury-draw?mobile="+g;"travel"==a("#themeType").val()&&(h="/activity/autumn/travel-draw?mobile="+g),i||a.ajax({url:h,type:"POST",dataType:"json"}).done(function(b){if(0==b.returnCode)switch(b.prize){case"PORCELAIN_CUP":e(0,337,"青花瓷杯子",b.prizeType);break;case"INTEREST_COUPON_2":e(1,56,"0.2%加息券",b.prizeType);break;case"LUXURY":e(2,116,"奢侈品大奖",b.prizeType);break;case"RED_ENVELOPE_100":e(3,160,"100元现金红包",b.prizeType);break;case"INTEREST_COUPON_5":e(4,230,"0.5%加息券",b.prizeType);break;case"RED_ENVELOPE_50":e(5,300,"50元现金红包",b.prizeType);break;case"MANGO_CARD_100":e(6,347,"100元芒果卡",b.prizeType)}else 2==b.returnCode?a("#tipList").html(d("tipListTpl",{tiptext:b.message,istype:"nologin"})).show().find(".tip-dom").show():3==b.returnCode?a("#tipList").html(d("tipListTpl",{tiptext:b.message,istype:"timeout"})).show().find(".tip-dom").show():a("#tipList").html(d("tipListTpl",{tiptext:b.message,istype:"notimes"})).show().find(".tip-dom").show()}).fail(function(){c.msg("请求失败")})}),a("body").on("click",".go-close",function(b){b.preventDefault();var c=a(this),d=c.parents(".tip-list"),e=d.find(".tip-dom");d.hide(),e.hide()});var l;a(".user-record").hover(function(){clearInterval(l)},function(){l=setInterval(function(){f(a("#recordList"))},2e3)}).trigger("mouseout")});